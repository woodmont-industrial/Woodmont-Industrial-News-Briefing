<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woodmont Industrial News Feed</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f8;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .header h1 { font-size: 2rem; margin-bottom: 8px; }
        .header p { opacity: 0.9; font-size: 1rem; }
        .header .links { margin-top: 15px; }
        .header .links a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 0.9rem;
        }
        .header .links a:hover { background: rgba(255,255,255,0.3); }
        
        /* Tab Navigation */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            background: white;
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: #f0f4f8;
            color: #1e3a5f;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: #e0e8f0;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .stats {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .stats span { color: #666; font-size: 0.9rem; }
        .stats strong { color: #1e3a5f; }
        
        .filters {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .filters input, .filters select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .filters input { width: 300px; max-width: 100%; }
        
        /* Article Grid */
        .article-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .article-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
        }
        
        .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .article-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: #e0e8f0;
        }
        
        .article-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .article-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-source { background: #e8f4f8; color: #1e3a5f; }
        .badge-category { background: #f0e6f8; color: #764ba2; }
        .badge-author { background: #e3f2fd; color: #1976d2; }
        
        .article-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .article-title a {
            color: #1e3a5f;
            text-decoration: none;
        }
        
        .article-title a:hover { color: #667eea; }
        
        .article-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .article-footer {
            margin-top: 15px;
            padding-top: 12px;
            border-top: 1px solid #eee;
            font-size: 0.85rem;
            color: #888;
        }
        
        .read-more {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .read-more:hover { text-decoration: underline; }
        
        /* Newsletter Generator Styles */
        .newsletter-generator {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .generator-controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }
        
        .generator-controls h2 {
            color: #1e3a5f;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .control-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .control-row label {
            font-weight: 500;
            color: #444;
        }
        
        .control-row select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Newsletter Preview Container */
        .newsletter-preview-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }
        
        .preview-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .preview-header h3 {
            color: #1e3a5f;
            font-size: 1.1rem;
        }
        
        .preview-actions {
            display: flex;
            gap: 10px;
        }
        
        .newsletter-preview {
            max-height: 700px;
            overflow-y: auto;
        }
        
        .newsletter-preview iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
        
        .empty-preview {
            padding: 60px 20px;
            text-align: center;
            color: #888;
        }
        
        .empty-preview p {
            margin-bottom: 15px;
        }
        
        /* Loading and Empty States */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e3a5f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 1.5rem; }
            .filters input { width: 100%; }
            .stats { flex-direction: column; align-items: flex-start; }
            .article-grid { grid-template-columns: 1fr; }
            .control-row { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè≠ Woodmont Industrial Partners</h1>
        <p>Daily Industrial News Feed</p>
        <p style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8;">Focus Markets: NJ, PA, FL, TX</p>
        <div class="links">
            <a href="rss.xml">üì° RSS Feed</a>
            <a href="feed.json">üìÑ JSON Feed</a>
        </div>
    </div>
    
    <!-- Tab Navigation -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('articles')">üì∞ Articles</button>
        <button class="tab-btn" onclick="switchTab('newsletter')">üìß Newsletter Generator</button>
    </div>
    
    <!-- Articles Tab -->
    <div id="articles-tab" class="tab-content active">
        <div class="container">
            <div class="stats" id="stats">
                <span>Loading articles...</span>
            </div>
            
            <div class="filters">
                <input type="text" id="search" placeholder="üîç Search articles..." oninput="filterArticles()">
                <select id="category" onchange="filterArticles()">
                    <option value="">All Categories</option>
                    <option value="relevant">Relevant Articles</option>
                    <option value="transaction">Transactions</option>
                    <option value="availabilities">Availabilities</option>
                    <option value="people">People News</option>
                </select>
                <select id="source" onchange="filterArticles()">
                    <option value="">All Sources</option>
                </select>
            </div>
            
            <div id="articles" class="article-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading articles...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Newsletter Generator Tab -->
    <div id="newsletter-tab" class="tab-content">
        <div class="newsletter-generator">
            <div class="generator-controls">
                <h2>üìß Generate Newsletter</h2>
                <div class="control-row">
                    <label for="timeframe">Coverage Period:</label>
                    <select id="timeframe">
                        <option value="1" selected>Last 24 hours</option>
                        <option value="2">Last 48 hours</option>
                        <option value="3">Last 3 days</option>
                        <option value="7">Last 7 days</option>
                        <option value="14">Last 14 days</option>
                        <option value="30">Last 30 days</option>
                    </select>
                    <label for="theme" style="margin-left: 15px;">Theme:</label>
                    <select id="theme">
                        <option value="default" selected>Default (Colorful)</option>
                        <option value="goth">Goth (Executive)</option>
                    </select>
                    <button class="btn btn-primary" onclick="generateNewsletter()">
                        ‚ú® Generate Newsletter
                    </button>
                    <button class="btn" style="background: #8b5cf6; color: white; margin-left: 10px;" onclick="showFeedHealth()">
                        üìä Feed Health
                    </button>
                </div>
            </div>
            
            <div class="newsletter-preview-container" id="preview-container" style="display: none;">
                <div class="preview-header">
                    <h3>üìã Newsletter Preview</h3>
                    <div class="preview-actions">
                        <button class="btn btn-success" onclick="downloadPDF()">üìÑ Download PDF</button>
                        <button class="btn btn-secondary" onclick="clearNewsletter()">Clear</button>
                    </div>
                </div>
                <div class="newsletter-preview" id="newsletter-preview">
                </div>
            </div>
            
            <div id="empty-preview" class="newsletter-preview-container">
                <div class="empty-preview">
                    <p style="font-size: 3rem;">üìß</p>
                    <p><strong>No newsletter generated yet</strong></p>
                    <p>Select a timeframe and click "Generate Newsletter" to create a preview based on your newsletter.html template.</p>
                </div>
            </div>

            <!-- Feed Health Report Section -->
            <div id="feed-health-container" class="newsletter-preview-container" style="display: none; margin-top: 20px;">
                <div class="preview-header">
                    <h3>üìä Feed Health Report</h3>
                    <div class="preview-actions">
                        <button class="btn btn-secondary" onclick="hideFeedHealth()">Close</button>
                    </div>
                </div>
                <div id="feed-health-summary" style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;"></div>
                <div id="feed-health-table" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script>
        let allArticles = [];
        let newsletterHTML = '';
        
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'articles') {
                document.querySelector('.tab-btn:first-child').classList.add('active');
                document.getElementById('articles-tab').classList.add('active');
            } else {
                document.querySelector('.tab-btn:last-child').classList.add('active');
                document.getElementById('newsletter-tab').classList.add('active');
            }
        }
        
        async function loadArticles() {
            const container = document.getElementById('articles');
            const statsEl = document.getElementById('stats');
            
            try {
                const response = await fetch('feed.json');
                if (!response.ok) throw new Error('Failed to load feed.json');
                
                const data = await response.json();
                allArticles = (data.items || [])
                    .filter(item => item.url && item.url.startsWith('http') && item.title) // Filter valid items
                    .map(item => {
                    // Handle author - prioritize author.name, then _source.feedName
                    let authorName = '';
                    if (item.author) {
                        authorName = typeof item.author === 'string' ? item.author : (item.author.name || '');
                    }
                    
                    // Handle source - use website domain from _source
                    let source = item._source?.website || item._source?.name || 'Unknown';
                    let feedName = item._source?.feedName || item._source?.name || source;
                    
                    // Use category directly if available, otherwise determine from tags
                    let category = item.category || 'relevant';
                    if (!item.category) {
                        const firstTag = (item.tags && item.tags[0]) || '';
                        const tagLower = firstTag.toLowerCase();
                        if (tagLower.includes('transaction')) category = 'transaction';
                        else if (tagLower.includes('availab')) category = 'availabilities';
                        else if (tagLower.includes('people')) category = 'people';
                    }
                    
                    // Generate unique image based on title hash if no image
                    let imageUrl = item.image;
                    if (!imageUrl) {
                        const titleHash = (item.title || '').split('').reduce((hash, char) => {
                            return ((hash << 5) - hash) + char.charCodeAt(0) | 0;
                        }, 0);
                        imageUrl = `https://picsum.photos/seed/${Math.abs(titleHash).toString(36)}/400/200`;
                    }
                    
                    return {
                        title: item.title || 'Untitled',
                        link: item.url || '#',
                        description: item.content_text || item.content_html || item.summary || '',
                        source: source,
                        feedName: feedName,
                        author: authorName !== source ? authorName : '', // Don't show author if same as source
                        category: category,
                        pubDate: item.date_published || new Date().toISOString(),
                        image: imageUrl
                    };
                });
                
                // Populate source filter
                const sources = [...new Set(allArticles.map(a => a.source))].filter(Boolean).sort();
                const sourceSelect = document.getElementById('source');
                sources.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s;
                    opt.textContent = s;
                    sourceSelect.appendChild(opt);
                });
                
                // Update stats
                statsEl.innerHTML = `
                    <span><strong>${allArticles.length}</strong> articles loaded</span>
                    <span>Last updated: <strong>${new Date().toLocaleDateString()}</strong></span>
                `;
                
                filterArticles();
                
            } catch (error) {
                console.error('Error loading articles:', error);
                container.innerHTML = `
                    <div class="error" style="grid-column: 1/-1; background: #fee; color: #c00; padding: 20px; border-radius: 10px;">
                        <strong>Error loading articles:</strong> ${error.message}<br>
                        <small>Please try refreshing the page.</small>
                    </div>
                `;
                statsEl.innerHTML = '<span style="color: #c00;">Failed to load articles</span>';
            }
        }
        
        function filterArticles() {
            const search = document.getElementById('search').value.toLowerCase();
            const category = document.getElementById('category').value;
            const source = document.getElementById('source').value;
            
            let filtered = allArticles.filter(article => {
                if (search && !article.title.toLowerCase().includes(search) && 
                    !article.description.toLowerCase().includes(search)) {
                    return false;
                }
                if (category && article.category !== category) return false;
                if (source && article.source !== source) return false;
                return true;
            });
            
            renderArticles(filtered);
        }
        
        function renderArticles(articles) {
            const container = document.getElementById('articles');
            
            if (articles.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <p>No articles found matching your filters.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = articles.map(article => {
                const date = new Date(article.pubDate);
                const dateStr = date.toLocaleDateString('en-US', { 
                    month: 'short', day: 'numeric', year: 'numeric' 
                });
                
                const categoryLabels = {
                    'relevant': 'Macro/Industrial',
                    'transaction': 'Transaction',
                    'availabilities': 'Availability',
                    'people': 'People News'
                };
                
                const categoryColors = {
                    'relevant': 'background: #e0e7ff; color: #3730a3;',
                    'transaction': 'background: #fef3c7; color: #92400e;',
                    'availabilities': 'background: #d1fae5; color: #065f46;',
                    'people': 'background: #f3e8ff; color: #6b21a8;'
                };
                
                const description = article.description.length > 150 
                    ? article.description.substring(0, 150) + '...' 
                    : article.description;
                
                // Use the pre-computed image URL
                const imageUrl = article.image;
                
                // Generate fallback seed from title for onerror
                const fallbackSeed = Math.abs(article.title.split('').reduce((h, c) => ((h << 5) - h) + c.charCodeAt(0) | 0, 0)).toString(36);
                
                return `
                    <div class="article-card">
                        <img src="${imageUrl}" alt="" class="article-image" onerror="this.src='https://picsum.photos/seed/${fallbackSeed}x/400/200'">
                        <div class="article-content">
                            <div class="article-meta">
                                <span class="badge badge-source">${article.source}</span>
                                ${article.author ? `<span class="badge badge-author">By ${article.author}</span>` : ''}
                            </div>
                            <h3 class="article-title">
                                <a href="${article.link}" target="_blank" rel="noopener">${article.title}</a>
                            </h3>
                            <p class="article-description">${description}</p>
                            <div class="article-footer">
                                <span>${dateStr}</span> ¬∑ 
                                <span class="badge badge-category" style="${categoryColors[article.category] || ''}">${categoryLabels[article.category] || 'Relevant'}</span>
                                <a href="${article.link}" target="_blank" rel="noopener" class="read-more" style="float: right;">Read more ‚Üí</a>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Newsletter Generation
        function generateNewsletter() {
            const days = parseInt(document.getElementById('timeframe').value);
            const theme = document.getElementById('theme').value;
            const cutoff = new Date(Date.now() - days * 24 * 60 * 60 * 1000);

            const recentArticles = allArticles.filter(article => {
                const pubDate = new Date(article.pubDate);
                return pubDate >= cutoff;
            });

            // Use selected theme
            newsletterHTML = theme === 'goth'
                ? buildGothNewsletterHTML(recentArticles, days)
                : buildNewsletterHTML(recentArticles, days);

            // Show preview
            document.getElementById('empty-preview').style.display = 'none';
            document.getElementById('preview-container').style.display = 'block';

            const previewEl = document.getElementById('newsletter-preview');
            const iframe = document.createElement('iframe');
            iframe.srcdoc = newsletterHTML;
            previewEl.innerHTML = '';
            previewEl.appendChild(iframe);
        }
        
        function buildNewsletterHTML(articles, days) {
            const now = new Date();
            const startDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);
            const dateRange = `${startDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })} ‚Äì ${now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })} (ET)`;

            const relevant = articles.filter(a => a.category === 'relevant').slice(0, 6);
            const transactions = articles.filter(a => a.category === 'transaction').slice(0, 5);
            const availabilities = articles.filter(a => a.category === 'availabilities').slice(0, 5);
            const people = articles.filter(a => a.category === 'people').slice(0, 5);

            // Industrial relevance context based on category
            const relevanceContext = {
                relevant: 'Macro trend affecting industrial real estate fundamentals and investment decisions.',
                transaction: 'This transaction signals market activity and pricing trends in the industrial sector.',
                availabilities: 'New availability in the market - potential opportunity for expansion or investment.',
                people: 'Personnel moves can indicate market shifts and new business opportunities.'
            };

            const renderArticle = (item, category, highlightClass = '') => {
                const title = item.title || 'Untitled';
                const region = item.regions && item.regions[0] ? item.regions[0] : 'US';
                const source = item.source || 'Unknown';
                const impactText = relevanceContext[category] || relevanceContext.relevant;

                // Category display name
                const categoryDisplay = {
                    relevant: 'MACRO TRENDS',
                    transaction: 'TRANSACTION',
                    availabilities: 'AVAILABILITY',
                    people: 'PEOPLE NEWS'
                }[category] || 'NEWS';

                return `
                    <div class="article-card ${highlightClass}">
                        <h3 class="article-title">${title}</h3>
                        <div class="article-badges">
                            <span class="badge badge-region">${region}</span>
                            <span class="badge badge-category">${categoryDisplay}</span>
                            <span class="badge badge-source">${source}</span>
                        </div>
                        <p class="article-desc">Read the full article about: ${title}</p>
                        <div class="impact-box">
                            <span class="impact-icon">üí°</span>
                            <span class="impact-text"><strong>Impact:</strong> ${impactText}</span>
                        </div>
                        <div class="article-footer">
                            <span class="source-label">üì∞ Source: <strong>${source}</strong></span>
                            <a href="${item.link}" class="read-more" target="_blank">Read Full Article ‚Üí</a>
                        </div>
                    </div>
                `;
            };

            const renderSection = (title, icon, items, category, highlightClass = '') => {
                const content = items.length > 0
                    ? items.map(item => renderArticle(item, category, highlightClass)).join('')
                    : '<div class="empty-section">No updated information provided for this section.</div>';
                return `
                    <div class="section">
                        <div class="section-header">
                            <span class="section-icon">${icon}</span>
                            <span class="section-title">${title}</span>
                        </div>
                        ${content}
                    </div>
                `;
            };
            
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woodmont Industrial Partners - Daily Briefing</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; padding: 20px; }
        .container { max-width: 850px; margin: 0 auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 35px; text-align: center; }
        .header h1 { font-size: 26px; margin-bottom: 10px; font-weight: 600; }
        .header .subtitle { font-size: 15px; opacity: 0.9; margin-bottom: 6px; }
        .header .date-range { font-size: 13px; opacity: 0.8; }
        .content { padding: 30px; }
        .section { margin-bottom: 35px; }
        .section-header { display: flex; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #1e3c72; }
        .section-icon { font-size: 20px; margin-right: 12px; }
        .section-title { font-size: 15px; color: #1e3c72; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }

        /* Article Card Styles */
        .article-card { background: white; border-left: 4px solid #667eea; padding: 20px 24px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .article-title { font-size: 17px; font-weight: 600; color: #1e293b; margin-bottom: 12px; line-height: 1.4; }
        .article-badges { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 14px; }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 15px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .badge-region { background: #dbeafe; color: #1d4ed8; }
        .badge-category { background: #dcfce7; color: #15803d; }
        .badge-source { background: #fef3c7; color: #b45309; }
        .article-desc { color: #64748b; font-size: 14px; margin-bottom: 14px; line-height: 1.5; }
        .impact-box { background: #fef9c3; border-left: 3px solid #facc15; padding: 12px 16px; margin-bottom: 16px; border-radius: 6px; display: flex; align-items: flex-start; gap: 10px; }
        .impact-icon { font-size: 16px; }
        .impact-text { color: #713f12; font-size: 13px; line-height: 1.5; }
        .article-footer { display: flex; align-items: center; justify-content: space-between; padding-top: 14px; border-top: 1px solid #e2e8f0; }
        .source-label { color: #64748b; font-size: 13px; }
        .read-more { color: #667eea; text-decoration: none; font-weight: 600; font-size: 13px; }
        .read-more:hover { text-decoration: underline; }

        .empty-section { color: #94a3b8; font-style: italic; font-size: 14px; padding: 20px; text-align: center; background: #f8fafc; border-radius: 8px; }
        .footer { background: #f8f9fa; padding: 25px 30px; text-align: center; color: #64748b; font-size: 12px; border-top: 1px solid #e2e8f0; }

        .transaction-highlight { border-left-color: #f59e0b; }
        .availability-highlight { border-left-color: #10b981; }
        .people-highlight { border-left-color: #8b5cf6; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè≠ Woodmont Industrial Partners</h1>
            <div class="subtitle">Daily Industrial News Briefing</div>
            <div class="date-range">Coverage Period: ${dateRange}</div>
            <div class="date-range">Focus Markets: NJ, PA, FL, TX</div>
        </div>
        <div class="content">
            ${renderSection('RELEVANT ARTICLES ‚Äî Macro Trends & Industrial Real Estate News', 'üì∞', relevant, 'relevant')}
            ${renderSection('TRANSACTIONS ‚Äî Notable Sales/Leases (‚â•100K SF or ‚â•$25M)', 'üíº', transactions, 'transaction', 'transaction-highlight')}
            ${renderSection('AVAILABILITIES ‚Äî New Industrial Properties for Sale/Lease', 'üè¢', availabilities, 'availabilities', 'availability-highlight')}
            ${renderSection('PEOPLE NEWS ‚Äî Personnel Moves in Industrial Brokerage/Development', 'üë•', people, 'people', 'people-highlight')}
        </div>
        <div class="footer">
            <strong>Woodmont Industrial Partners</strong><br>
            Daily Industrial News Briefing ‚Äì Confidential & Proprietary<br>
            ¬© ${new Date().getFullYear()} All Rights Reserved
        </div>
    </div>
</body>
</html>`;
        }
        
        function clearNewsletter() {
            newsletterHTML = '';
            document.getElementById('newsletter-preview').innerHTML = '';
            document.getElementById('preview-container').style.display = 'none';
            document.getElementById('empty-preview').style.display = 'block';
        }
        
        async function downloadPDF() {
            if (!newsletterHTML) {
                alert('Generate newsletter first');
                return;
            }
            
            try {
                // Create temporary container
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = newsletterHTML;
                tempDiv.style.width = '800px';
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.top = '0';
                tempDiv.style.background = 'white';
                document.body.appendChild(tempDiv);
                
                // Wait a moment for styles to apply
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Generate canvas
                const canvas = await html2canvas(tempDiv, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: 800,
                    windowWidth: 800
                });
                
                document.body.removeChild(tempDiv);
                
                // Create PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                
                let heightLeft = pdfHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
                heightLeft -= pdf.internal.pageSize.getHeight();
                
                while (heightLeft > 0) {
                    position = heightLeft - pdfHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
                    heightLeft -= pdf.internal.pageSize.getHeight();
                }
                
                const date = new Date().toISOString().split('T')[0];
                pdf.save(`woodmont-newsletter-${date}.pdf`);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            }
        }
        
        // Goth theme newsletter builder - executive style, dark header
        function buildGothNewsletterHTML(articles, days) {
            const now = new Date();
            const startDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);
            const dateRange = `${startDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })} ‚Äì ${now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })} (ET)`;

            const relevant = articles.filter(a => a.category === 'relevant').slice(0, 6);
            const transactions = articles.filter(a => a.category === 'transaction').slice(0, 5);
            const availabilities = articles.filter(a => a.category === 'availabilities').slice(0, 5);
            const people = articles.filter(a => a.category === 'people').slice(0, 5);

            const formatBullet = (item) => {
                const title = item.title || 'Untitled';
                const url = item.link || '#';
                const source = item.source || 'Industry News';
                const desc = (item.description || '').substring(0, 180) + (item.description && item.description.length > 180 ? '...' : '');

                return `<li style="margin-bottom: 16px; padding-bottom: 14px; border-bottom: 1px solid #e8e8e8; list-style: none;">
                    <a href="${url}" style="color: #1e3c72; text-decoration: none; font-weight: 600; font-size: 15px; line-height: 1.4; display: block;">${title}</a>
                    ${desc ? `<p style="margin: 8px 0 0 0; color: #555; font-size: 13px; line-height: 1.5;">${desc}</p>` : ''}
                    <div style="margin-top: 8px;">
                        <a href="${url}" style="color: #2563eb; text-decoration: none; font-size: 12px;">Read at ${source} ‚Üí</a>
                    </div>
                </li>`;
            };

            const renderSection = (title, items) => {
                if (!items || items.length === 0) {
                    return `<div style="margin-bottom: 28px;">
                        <h3 style="color: #1e3c72; font-size: 16px; font-weight: 700; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e8e8e8;">${title}</h3>
                        <p style="color: #888; font-style: italic; margin-left: 20px;">No updates for this section.</p>
                    </div>`;
                }
                return `<div style="margin-bottom: 28px;">
                    <h3 style="color: #1e3c72; font-size: 16px; font-weight: 700; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e8e8e8;">${title}</h3>
                    <ul style="margin: 0; padding-left: 0;">${items.map(formatBullet).join('')}</ul>
                </div>`;
            };

            return `<!DOCTYPE html><html><head><meta charset="UTF-8"></head><body style="margin: 0; padding: 20px; background: #f4f4f4; font-family: 'Segoe UI', Arial, sans-serif;">
                <div style="max-width: 700px; margin: 0 auto; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); color: #fff; padding: 30px; text-align: center;">
                        <h1 style="margin: 0 0 8px 0; font-size: 24px; font-weight: 700;">üè≠ Woodmont Industrial Partners</h1>
                        <p style="margin: 0 0 4px 0; font-size: 14px; opacity: 0.9;">Daily Industrial News Briefing ‚Äî Executive Summary</p>
                        <p style="margin: 0; font-size: 12px; opacity: 0.7;">${dateRange} | Focus: NJ, PA, FL, TX</p>
                    </div>
                    <div style="padding: 24px;">
                        ${renderSection('üì∞ MARKET INTELLIGENCE', relevant)}
                        ${renderSection('üíº TRANSACTIONS (‚â•100K SF or ‚â•$25M)', transactions)}
                        ${renderSection('üè¢ AVAILABILITIES', availabilities)}
                        ${renderSection('üë• PEOPLE MOVES', people)}
                    </div>
                    <div style="background: #f8f8f8; padding: 20px; text-align: center; color: #666; font-size: 12px; border-top: 1px solid #e8e8e8;">
                        <strong>Woodmont Industrial Partners</strong><br>
                        Daily Industrial News Briefing ‚Äì Confidential & Proprietary<br>
                        ¬© ${new Date().getFullYear()} All Rights Reserved
                    </div>
                </div>
            </body></html>`;
        }

        // Feed Health Functions
        async function showFeedHealth() {
            try {
                const res = await fetch('feed-health.json');
                if (!res.ok) throw new Error('Feed health report not found');
                const data = await res.json();

                // Show summary
                const summary = document.getElementById('feed-health-summary');
                summary.innerHTML = `
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <span>Generated: <strong>${new Date(data.generatedAt).toLocaleString()}</strong></span>
                        <span style="color: green;">‚úì ${data.successfulFeeds} OK</span>
                        <span style="color: red;">‚úï ${data.failedFeeds} Failed</span>
                        <span>${data.totalArticlesFetched} fetched ‚Üí ${data.totalArticlesKept} kept</span>
                    </div>
                `;

                // Show table
                const tableHtml = `
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead>
                            <tr style="background: #f0f4f8; text-align: left;">
                                <th style="padding: 10px; border-bottom: 2px solid #ddd;">Feed Name</th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd;">Status</th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd; text-align: right;">Fetched</th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd; text-align: right;">Kept</th>
                                <th style="padding: 10px; border-bottom: 2px solid #ddd;">Error</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.feeds.map(feed => `
                                <tr style="background: ${feed.status === 'failed' ? '#fff5f5' : 'white'};">
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">
                                        <div style="font-weight: 600;">${feed.name}</div>
                                        <div style="font-size: 11px; color: #888; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${feed.url}</div>
                                    </td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee;">
                                        <span style="padding: 3px 8px; border-radius: 4px; font-size: 12px; background: ${feed.status === 'ok' ? '#d4edda' : '#f8d7da'}; color: ${feed.status === 'ok' ? '#155724' : '#721c24'};">
                                            ${feed.status === 'ok' ? 'OK' : 'FAILED'}
                                        </span>
                                    </td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">${feed.fetchedRaw}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">${feed.keptAfterFiltering}</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #eee; font-size: 12px; color: #dc3545; max-width: 200px; overflow: hidden; text-overflow: ellipsis;" title="${feed.lastError || ''}">
                                        ${feed.lastError || '-'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                document.getElementById('feed-health-table').innerHTML = tableHtml;
                document.getElementById('feed-health-container').style.display = 'block';

            } catch (e) {
                console.error('Error fetching feed health:', e);
                alert('Feed health report not available yet. It will be generated on the next scheduled RSS update.');
            }
        }

        function hideFeedHealth() {
            document.getElementById('feed-health-container').style.display = 'none';
        }

        // Load articles on page load
        loadArticles();
    </script>
</body>
</html>
