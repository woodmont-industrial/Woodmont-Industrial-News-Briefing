<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Woodmont Industrial News Feed</title>
  <script src="https://cdn.tailwindcss.com?plugins=line-clamp"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #064e3b 0%, #047857 50%, #10b981 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      min-height: 100vh;
    }
    .card-anim {
      transition: transform 200ms ease, box-shadow 200ms ease, opacity 200ms ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08), 0 1px 3px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.06);
    }
    .card-anim:hover {
      transform: translateY(-6px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.12), 0 8px 16px rgba(0,0,0,0.08);
      opacity: 1;
    }
    .img-anim { transition: transform 300ms ease; }
    .card-anim:hover .img-anim { transform: scale(1.05); }
    .clamp-2 { display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
    .clamp-3 { display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }

    /* Dark theme styles */
    .dark { background-color: #0f172a; color: #f1f5f9; }
    .dark .card-anim {
      background-color: #1e293b;
      border-color: #334155;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3), 0 1px 3px rgba(0,0,0,0.2);
    }
    .dark .card-anim:hover {
      background-color: #334155;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 8px 16px rgba(0,0,0,0.3);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white !important;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 25px 80px rgba(0,0,0,0.25), 0 10px 30px rgba(0,0,0,0.15);
      position: relative;
      z-index: 1;
    }

    .dark .container {
      background: #1e293b !important;
    }

    .newsletter-content .section {
      margin-bottom: 35px;
    }
    .newsletter-content .section-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #10b981;
    }
    .newsletter-content .section-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      font-weight: bold;
      color: white;
    }
    .newsletter-content .article-item {
      margin-bottom: 20px;
      padding: 16px;
      background: #f8fafc;
      border-radius: 8px;
      border-left: 4px solid #10b981;
    }
    .newsletter-content .article-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #1e293b;
    }
    .newsletter-content .article-meta {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 8px;
    }
    .newsletter-content .article-summary {
      font-size: 14px;
      color: #475569;
      line-height: 1.5;
    }
    .newsletter-content .transaction-highlight {
      background: #fef3c7;
      border-left-color: #f59e0b;
    }
    .newsletter-content .availability-highlight {
      background: #ecfdf5;
      border-left-color: #10b981;
    }
    .newsletter-content .people-highlight {
      background: #fef3c7;
      border-left-color: #f59e0b;
    }

    /* Tracked article highlighting */
    .tracked-highlight {
      position: relative;
      border: 2px solid #10b981 !important;
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.3) !important;
    }
    .tracked-highlight::before {
      content: 'TRACKED';
      position: absolute;
      top: -10px;
      right: 12px;
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 4px;
      z-index: 10;
    }
    .track-btn {
      transition: all 0.2s ease;
    }
    .track-btn:hover {
      transform: scale(1.05);
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      body { padding: 10px; }
      .container { border-radius: 12px; }
    }
    </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    const { useState, useEffect, useMemo, useCallback } = React;

    const regions = ["All", "NJ", "PA", "FL", "TX"];
    const IS_STATIC = window.location.hostname !== 'localhost';
    const API_BASE = '';

    const Header = ({ timeframe, theme, setTheme }) => {
      const period = (() => {
        const days = parseInt(timeframe, 10);
        if (days === 1) return "Last 24 Hours";
        if (days === 2) return "Last 48 Hours";
        if (days === 3) return "Last 3 Days";
        if (days === 7) return "Last 7 Days";
        if (days === 14) return "Last 14 Days";
        if (days === 30) return "Last 30 Days";
        if (days === 90) return "Last 90 Days";
        if (days === 180) return "Last 6 Months";
        return "All Time";
      })();

      return (
        <header className="relative overflow-hidden">
          <div className="absolute inset-0 bg-gradient-to-br from-emerald-900 via-emerald-700 to-emerald-500"></div>
          <div className="relative px-6 py-10 text-center text-white">
            <div className="flex items-center justify-center gap-6">
              <div>
                <h1 className="text-4xl md:text-5xl font-bold mb-3 tracking-tight drop-shadow-lg">
                  üè¢ Woodmont Industrial Partners
                </h1>
                <p className="text-2xl md:text-3xl font-semibold mb-4 text-emerald-100">
                  Daily Real Estate News Briefing
                </p>
                <div className="flex flex-wrap items-center justify-center gap-3 mt-4">
                  <span className="inline-flex items-center px-4 py-2 rounded-full bg-white/20 backdrop-blur-sm text-base font-medium">
                    üìÖ {period}
                  </span>
                  <span className="inline-flex items-center px-4 py-2 rounded-full bg-white/20 backdrop-blur-sm text-base font-medium">
                    üìç Focus Markets: <strong className="ml-1">NJ ‚Ä¢ PA ‚Ä¢ FL</strong>
                  </span>
                </div>
              </div>
              <button
                onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}
                className="p-3 rounded-xl bg-white/20 backdrop-blur-sm hover:bg-white/30 transition-all text-xl"
                title={`Switch to ${theme === 'light' ? 'dark' : 'light'} theme`}
              >
                {theme === 'light' ? 'üåô' : '‚òÄÔ∏è'}
              </button>
            </div>
          </div>
        </header>
      );
    };

    const FiltersBar = ({ query, setQuery, region, setRegion, source, setSource, category, setCategory, sort, setSort, timeframe, setTimeframe, sources, onRefresh, stats, viewMode, setViewMode, lastFetchInfo, refreshLoading }) => (
      <>
        <div className="max-w-6xl mx-auto px-4 pb-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
          <div className="flex-1 flex gap-3 flex-wrap">
            <input
              className="w-full md:w-80 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white placeholder-slate-500 dark:placeholder-slate-400"
              placeholder="Search title or summary"
              value={query}
              onChange={(e) => setQuery(e.target.value)}
            />
            <select
              className="w-36 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
              value={region}
              onChange={(e) => setRegion(e.target.value)}
            >
              {regions.map(r => <option key={r} value={r === "All" ? "" : r}>{r}</option>)}
            </select>
            <select
              className="w-52 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
              value={category}
              onChange={(e) => setCategory(e.target.value)}
            >
              <option value="">Category: All</option>
              <option value="relevant">Relevant News</option>
              <option value="transactions">Transactions</option>
              <option value="availabilities">Availabilities</option>
              <option value="people">People News</option>
            </select>
            <select
              className="w-44 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
              value={source}
              onChange={(e) => setSource(e.target.value)}
            >
              <option value="">Source: All</option>
              {sources.map(s => <option key={s} value={s}>{s}</option>)}
            </select>
            <select
              className="w-32 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
              value={sort}
              onChange={(e) => setSort(e.target.value)}
            >
              <option value="newest">Newest</option>
              <option value="oldest">Oldest</option>
            </select>
            <select
              className="w-40 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
              value={timeframe}
              onChange={(e) => setTimeframe(e.target.value)}
            >
              <option value="1">Last 24 hours</option>
              <option value="2">Last 48 hours</option>
              <option value="3">Last 3 days</option>
              <option value="7">Last 7 days</option>
              <option value="14">Last 14 days</option>
              <option value="30">Last 30 days</option>
              <option value="90">Last 90 days</option>
            </select>
          </div>
          <div className="flex gap-3 items-center">
            <div className="text-sm text-slate-600 dark:text-slate-400">
              {stats.filtered} of {stats.total} articles ‚Ä¢ Updated {stats.updated}
            </div>
              <div className="flex gap-2">
              <button
                  onClick={() => setViewMode(viewMode === "articles" ? "newsletter" : "articles")}
                  className={`px-4 py-2 rounded-xl font-medium transition-all ${
                  viewMode === "articles"
                      ? "bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"
                      : "bg-emerald-500 text-white"
                }`}
              >
                  {viewMode === "articles" ? "üìß Newsletter" : "üì∞ Articles"}
              </button>
              {!IS_STATIC && (
              <button
                  onClick={() => setViewMode(viewMode === "admin" ? "articles" : "admin")}
                  className={`px-4 py-2 rounded-xl font-medium transition-all ${
                    viewMode === "admin"
                      ? "bg-purple-500 text-white"
                      : "bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"
                  }`}
                >
                  ‚öôÔ∏è Admin
              </button>
              )}
            </div>
            <button
              onClick={onRefresh}
              disabled={refreshLoading}
              className="px-4 py-2 bg-green-500 text-white rounded-xl font-medium hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2"
            >
              {refreshLoading ? (
                <>
                  <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>
                  Refreshing...
                </>
              ) : (
                <>
                  üîÑ Refresh
                </>
              )}
            </button>
          </div>
        </div>
        <div className="max-w-6xl mx-auto px-4 pb-4">
          {lastFetchInfo && (
            <div className="bg-slate-50 dark:bg-slate-800 rounded-lg p-3 text-sm border border-slate-200 dark:border-slate-700">
              <div className="flex items-center gap-4 flex-wrap">
                <div className="flex items-center gap-2">
                  <span className="text-slate-600 dark:text-slate-400">Last fetched:</span>
                  <span className="font-medium text-slate-900 dark:text-slate-100">
                    {lastFetchInfo.timestamp ? new Date(lastFetchInfo.timestamp).toLocaleString() : 'Never'}
                  </span>
                </div>
                <div className="flex items-center gap-3">
                  <span className="flex items-center gap-1">
                    <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                    <span className="text-green-600 font-medium">{lastFetchInfo.totalFetched || lastFetchInfo.fetched || 0}</span>
                    <span className="text-slate-600 dark:text-slate-400">fetched</span>
                  </span>
                  <span className="flex items-center gap-1">
                    <span className="w-2 h-2 bg-emerald-500 rounded-full"></span>
                    <span className="text-emerald-600 font-medium">{lastFetchInfo.totalKept || lastFetchInfo.kept || 0}</span>
                    <span className="text-slate-600 dark:text-slate-400">kept</span>
                  </span>
                  <span className="flex items-center gap-1">
                    <span className="w-2 h-2 bg-purple-500 rounded-full"></span>
                    <span className="text-purple-600 font-medium">{lastFetchInfo.sourcesProcessed || lastFetchInfo.sources || 0}</span>
                    <span className="text-slate-600 dark:text-slate-400">sources</span>
                  </span>
                </div>
                {lastFetchInfo && (lastFetchInfo.lastArticle || lastFetchInfo.latestTitle) && (
                  <div className="flex items-center gap-2 ml-auto">
                    <span className="text-slate-600 dark:text-slate-400">Latest:</span>
                    <span className="font-medium text-slate-900 dark:text-slate-100 max-w-xs truncate" title={lastFetchInfo.lastArticle?.title || lastFetchInfo.latestTitle}>
                      {lastFetchInfo.lastArticle?.title || lastFetchInfo.latestTitle || 'N/A'}
                    </span>
                  </div>
                )}
              </div>
            </div>
          )}
        </div>
      </>
    );

    // Branded placeholder images based on category
    const getPlaceholderImage = (category, title = '') => {
      // Use category-specific professional images
      const placeholders = {
        transactions: [
          'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop', // Modern building
          'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=600&h=400&fit=crop', // Keys/deal
          'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=600&h=400&fit=crop', // Business meeting
        ],
        availabilities: [
          'https://images.unsplash.com/photo-1565610222536-ef125c59da2e?w=600&h=400&fit=crop', // Industrial building
          'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600&h=400&fit=crop', // Warehouse
          'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=600&h=400&fit=crop', // Construction
        ],
        people: [
          'https://images.unsplash.com/photo-1560250097-0b93528c311a?w=600&h=400&fit=crop', // Business person
          'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=600&h=400&fit=crop', // Professional
          'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=600&h=400&fit=crop', // Executive
        ],
        relevant: [
          'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop', // Skyline
          'https://images.unsplash.com/photo-1497366216548-37526070297c?w=600&h=400&fit=crop', // Office building
          'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?w=600&h=400&fit=crop', // Construction
        ]
      };

      const categoryImages = placeholders[category] || placeholders.relevant;
      // Use title hash to get consistent image for same article
      const hash = (title || '').split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
      return categoryImages[hash % categoryImages.length];
    };

    const ArticleCard = ({ item, onClick, trackedMatches = [], onTrackKeyword, onIgnoreKeyword }) => {
      const category = item.category || 'relevant';
      const fallback = getPlaceholderImage(category, item.title);
      const [imgSrc, setImgSrc] = useState(item.image || fallback);
      const [imgError, setImgError] = useState(false);

      const published = item.pubDate ? new Date(item.pubDate) : null;
      const isValidDate = published && !isNaN(published.getTime());
      const isTracked = trackedMatches.length > 0;
      const suggestedKeywords = extractTrackableKeywords(item);

      // Format date consistently - "Jan 27, 2026"
      const formatDate = (date) => {
        if (!date || isNaN(date.getTime())) return null;
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      };

      // Get standardized snippet - always show something
      const getSnippet = () => {
        if (item.description && item.description.trim().length > 20) {
          const desc = item.description.trim();
          return desc.length > 150 ? desc.substring(0, 147) + '...' : desc;
        }
        // Fallback snippet based on category and source
        const source = typeof item.source === 'string' ? item.source : (item.source?.name || 'this source');
        const categoryText = {
          transactions: 'property transaction',
          availabilities: 'available property listing',
          people: 'personnel move',
          relevant: 'industry news'
        };
        return `Read the full ${categoryText[category] || 'article'} from ${source}.`;
      };

      // Quick track - uses first suggested keyword or source
      const quickTrack = () => {
        const keyword = suggestedKeywords[0] || item.source || item.title?.split(' ').slice(0, 2).join(' ');
        if (keyword) {
          onTrackKeyword && onTrackKeyword(keyword, item.title);
        }
      };

      // Quick ignore - uses source or first keyword
      const quickIgnore = () => {
        const keyword = item.source || suggestedKeywords[0] || item.title?.split(' ').slice(0, 2).join(' ');
        if (keyword) {
          onIgnoreKeyword && onIgnoreKeyword(keyword);
        }
      };

      // Category config with colors and icons
      const categoryConfig = {
        transactions: { color: 'from-amber-500/90', bgLight: 'bg-amber-100', bgDark: 'dark:bg-amber-900/60', textLight: 'text-amber-800', textDark: 'dark:text-amber-200', border: 'border-amber-300 dark:border-amber-700', icon: 'üíº' },
        availabilities: { color: 'from-emerald-500/90', bgLight: 'bg-emerald-100', bgDark: 'dark:bg-emerald-900/60', textLight: 'text-emerald-800', textDark: 'dark:text-emerald-200', border: 'border-emerald-300 dark:border-emerald-700', icon: 'üè¢' },
        people: { color: 'from-violet-500/90', bgLight: 'bg-violet-100', bgDark: 'dark:bg-violet-900/60', textLight: 'text-violet-800', textDark: 'dark:text-violet-200', border: 'border-violet-300 dark:border-violet-700', icon: 'üë•' },
        relevant: { color: 'from-blue-600/90', bgLight: 'bg-blue-100', bgDark: 'dark:bg-blue-900/60', textLight: 'text-blue-800', textDark: 'dark:text-blue-200', border: 'border-blue-300 dark:border-blue-700', icon: 'üì∞' }
      };

      const catConfig = categoryConfig[category] || categoryConfig.relevant;

      return (
        <article
          className={`card-anim bg-white dark:bg-slate-800 rounded-2xl overflow-hidden flex flex-col h-full focus-within:ring-2 focus-within:ring-emerald-400 dark:focus-within:ring-emerald-600 cursor-pointer ${isTracked ? 'tracked-highlight' : ''}`}
          onClick={(e) => {
            // Don't trigger onClick if clicking the track menu
            if (!e.target.closest('.track-menu-container')) {
              onClick && onClick(item);
            }
          }}
        >
          <div className="relative aspect-video bg-slate-200 dark:bg-slate-900 overflow-hidden">
            <img
              src={imgError ? fallback : (imgSrc || fallback)}
              alt={item.title || 'Article image'}
              className="img-anim w-full h-full object-cover"
              loading="lazy"
              onError={() => {
                setImgError(true);
                setImgSrc(fallback);
              }}
            />
            {/* Gradient overlay with category color */}
            <div className={`absolute inset-0 bg-gradient-to-t ${catConfig.color} via-transparent to-transparent pointer-events-none`}></div>
            {/* Source badge - more prominent */}
            <div className="absolute top-3 left-3 right-3 flex justify-between items-start">
              <span
                className="bg-white/95 dark:bg-slate-800/95 text-slate-900 dark:text-slate-100 text-xs font-bold px-3 py-1.5 rounded-lg shadow-md uppercase tracking-wide cursor-pointer hover:bg-emerald-50 dark:hover:bg-emerald-900/50 transition-colors"
                onClick={(e) => {
                  e.stopPropagation();
                  const src = typeof item.source === 'string' ? item.source : (item.source?.name || '');
                  if (src) onTrackKeyword && onTrackKeyword(src, '');
                }}
                title="Click to track this source"
              >
                {(() => {
                  const src = item.source || item.publisher;
                  if (!src) return 'Source';
                  return typeof src === 'string' ? src : (src.name || 'Source');
                })()}
              </span>
              {/* Category badge with icon */}
              <span className={`${catConfig.bgLight} ${catConfig.bgDark} ${catConfig.textLight} ${catConfig.textDark} text-xs font-bold px-3 py-1.5 rounded-lg shadow-md border ${catConfig.border}`}>
                {catConfig.icon} {item.category === 'transactions' ? 'Transaction' :
                 item.category === 'availabilities' ? 'Available' :
                 item.category === 'people' ? 'People' :
                 'News'}
              </span>
            </div>
          </div>
          <div className="p-4 flex flex-col gap-3 flex-1">
            {/* Date and author row */}
            <div className="flex items-center gap-2 flex-wrap text-xs">
              {isValidDate && (
                <span className="text-slate-500 dark:text-slate-400 font-medium">
                  {formatDate(published)}
                </span>
              )}
              {item.author && (
                <span className="text-emerald-600 dark:text-emerald-400 font-medium">
                  ‚Ä¢ By {typeof item.author === 'string' ? item.author : (item.author.name || 'Staff')}
                </span>
              )}
            </div>
            <h3 className="text-lg font-semibold text-slate-900 dark:text-slate-100 leading-tight clamp-2">
              <a
                href={item.link}
                target="_blank"
                rel="noopener noreferrer"
                className="hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors"
              >
                {item.title}
              </a>
            </h3>
            {/* Standardized snippet - always shows */}
            <p className="text-sm text-slate-600 dark:text-slate-400 clamp-3 flex-1 leading-relaxed">
              {getSnippet()}
            </p>
            <div className="mt-auto pt-3 border-t border-slate-100 dark:border-slate-700 flex items-center justify-between">
              <a
                href={item.link}
                target="_blank"
                rel="noopener noreferrer"
                className="inline-flex items-center gap-2 text-sm font-semibold text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 transition-colors"
                onClick={(e) => e.stopPropagation()}
              >
                Read more ‚Üí
              </a>

              {/* Action Buttons */}
              <div className="track-menu-container relative flex items-center gap-2">
                {/* Track Button */}
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    if (!isTracked) {
                      quickTrack();
                    }
                  }}
                  className={`track-btn px-3 py-1 rounded-lg text-xs font-bold transition-all ${
                    isTracked
                      ? 'bg-emerald-500 text-white border border-emerald-600 cursor-default'
                      : 'bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-emerald-500 hover:text-white cursor-pointer'
                  }`}
                >
                  {isTracked ? 'TRACKING' : 'Track'}
                </button>

                {/* Ignore Button - Always visible in red */}
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    quickIgnore();
                  }}
                  className="px-3 py-1 rounded-lg text-xs font-bold bg-red-100 dark:bg-red-900/40 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-700 hover:bg-red-500 hover:text-white hover:border-red-500 transition-all cursor-pointer"
                >
                  Ignore
                </button>

              </div>
            </div>
          </div>
        </article>
      );
    };

    const ArticleGrid = ({ items, loading, onArticleClick, trackedTopics, onTrackKeyword, onIgnoreKeyword, ignoredTopics }) => {
      // Calculate matches for each article
      const getArticleMatches = (article) => {
        return getMatchingTrackedTopics(article);
      };

      // Filter out ignored articles
      const visibleItems = items.filter(item => !isArticleIgnored(item));
      const hiddenCount = items.length - visibleItems.length;

      return (
        <div className="max-w-6xl mx-auto px-4">
          {hiddenCount > 0 && (
            <div className="mb-4 text-sm text-slate-500 dark:text-slate-400 text-center">
              {hiddenCount} article{hiddenCount !== 1 ? 's' : ''} hidden based on your ignore preferences
            </div>
          )}
          {loading ? (
            <div className="text-center py-12">
              <div className="animate-spin text-4xl mb-4">‚ü≥</div>
              <p className="text-slate-600 dark:text-slate-400">Loading articles...</p>
            </div>
          ) : visibleItems.length === 0 ? (
            <div className="text-center py-12">
              <p className="text-slate-600 dark:text-slate-400">No articles found.</p>
            </div>
          ) : (
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
              {visibleItems.map(item => (
                <ArticleCard
                  key={item.id || item.link}
                  item={item}
                  onClick={onArticleClick}
                  trackedMatches={getArticleMatches(item)}
                  onTrackKeyword={onTrackKeyword}
                  onIgnoreKeyword={onIgnoreKeyword}
                />
              ))}
            </div>
          )}
        </div>
      );
    };

    const ArticlePreview = ({ article, onClose, onBlacklist }) => {
      if (!article) return null;

      const published = article.pubDate ? new Date(article.pubDate) : null;
      const isValidDate = published && !isNaN(published.getTime());

        return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-200 dark:border-slate-700">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <h2 className="text-2xl font-bold text-slate-900 dark:text-slate-100 mb-2 leading-tight">
                    {article.title}
                  </h2>
                  <div className="flex items-center gap-4 text-sm text-slate-600 dark:text-slate-400">
                    <span className="font-medium">{article.publisher || article.source}</span>
                    {article.author && <span>by {article.author}</span>}
                    {isValidDate && <span>{published.toLocaleDateString()}</span>}
                    {article.category && (
                      <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                        article.category === 'transactions' ? 'bg-amber-100 dark:bg-amber-900 text-amber-800 dark:text-amber-200' :
                        article.category === 'availabilities' ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' :
                        article.category === 'people' ? 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200' :
                        'bg-slate-100 dark:bg-slate-700 text-slate-800 dark:text-slate-200'
                      }`}>
                        {article.category === 'transactions' ? 'Transactions' :
                         article.category === 'availabilities' ? 'Availabilities' :
                         article.category === 'people' ? 'People News' :
                         'Relevant News'}
                      </span>
                    )}
                  </div>
                </div>
                <button
                  onClick={onClose}
                  className="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors"
                >
                  ‚úï
                </button>
              </div>
            </div>

            {/* Content */}
            <div className="p-6 overflow-y-auto max-h-[60vh]">
              {article.image && (
                <div className="mb-6">
                  <img
                    src={article.image}
                    alt={article.title}
                    className="w-full h-64 object-cover rounded-lg"
                  />
                </div>
              )}

              {article.description && (
                <div className="prose dark:prose-invert max-w-none">
                  <p className="text-lg text-slate-700 dark:text-slate-300 leading-relaxed mb-6">
                    {article.description}
                  </p>
                </div>
              )}

              {/* Article Metadata */}
              <div className="border-t border-slate-200 dark:border-slate-700 pt-6 mt-6">
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <span className="font-medium text-slate-900 dark:text-slate-100">Source:</span>
                    <span className="ml-2 text-slate-600 dark:text-slate-400">{article.source || article.publisher}</span>
                  </div>
                  <div>
                    <span className="font-medium text-slate-900 dark:text-slate-100">Published:</span>
                    <span className="ml-2 text-slate-600 dark:text-slate-400">
                      {isValidDate ? published.toLocaleString() : 'Unknown'}
                    </span>
                  </div>
                  {article.regions && article.regions.length > 0 && (
                    <div>
                      <span className="font-medium text-slate-900 dark:text-slate-100">Regions:</span>
                      <span className="ml-2 text-slate-600 dark:text-slate-400">{article.regions.join(', ')}</span>
                    </div>
                  )}
                  {article.topics && article.topics.length > 0 && (
                    <div>
                      <span className="font-medium text-slate-900 dark:text-slate-100">Topics:</span>
                      <span className="ml-2 text-slate-600 dark:text-slate-400">{article.topics.join(', ')}</span>
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* Footer */}
            <div className="p-6 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800">
              <div className="flex justify-between items-center">
                <div>
                  {onBlacklist && (
                    <button
                      onClick={() => {
                        if (confirm('Blacklist this article? It will be hidden from the feed.')) {
                          onBlacklist(article.id);
                          onClose();
                        }
                      }}
                      className="px-4 py-2 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 transition-colors"
                    >
                      Blacklist Article
                    </button>
                  )}
                </div>
                <div className="flex gap-3">
                  <button
                    onClick={onClose}
                    className="px-4 py-2 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 transition-colors"
                  >
                    Close
                  </button>
                  <a
                    href={article.link}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="px-6 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors"
                  >
                    Read Full Article ‚Üí
                  </a>
                </div>
              </div>
            </div>
          </div>
          </div>
        );
    };

    const AdminPanel = ({ manualTitle, setManualTitle, manualUrl, setManualUrl, manualSummary, setManualSummary, manualCategory, setManualCategory, manualSource, setManualSource, showManualForm, setShowManualForm, onAddManualArticle, newsletterRecipients, setNewsletterRecipients, reviewMode, setReviewMode, filteredArticles, fetchFilteredArticles, approveArticle, blacklistArticle, reviewCategory, setReviewCategory }) => {
      return (
        <div className="max-w-6xl mx-auto px-4 pb-12">
          {/* Article Review Section */}
          <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-sm p-6 mb-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-semibold text-slate-900 dark:text-slate-100">üîç Review Filtered Articles</h2>
              <button
                onClick={() => {
                  setReviewMode(!reviewMode);
                  if (!reviewMode) fetchFilteredArticles();
                }}
                className="px-4 py-2 bg-purple-500 text-white rounded-lg font-medium hover:bg-purple-600 transition-colors"
              >
                {reviewMode ? 'Hide Review' : 'Show Review'}
              </button>
            </div>

            {reviewMode && (
              <div className="space-y-4">
                <div className="flex items-center gap-4">
                  <label className="text-sm font-medium text-slate-700 dark:text-slate-300">Filter by category:</label>
                  <select
                    className="rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-1 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
                    value={reviewCategory}
                    onChange={(e) => {
                      setReviewCategory(e.target.value);
                      fetchFilteredArticles();
                    }}
                  >
                    <option value="not relevant">Not Relevant ({filteredArticles.filter(a => a.category === 'not relevant').length})</option>
                    <option value="excluded">Excluded ({filteredArticles.filter(a => a.category === 'excluded').length})</option>
                    <option value="unapproved source">Unapproved Source ({filteredArticles.filter(a => a.category === 'unapproved source').length})</option>
                  </select>
                  <span className="text-sm text-slate-600 dark:text-slate-400">
                    Showing {filteredArticles.filter(a => a.category === reviewCategory).length} articles
                  </span>
                </div>

                <div className="space-y-3 max-h-96 overflow-y-auto">
                  {filteredArticles.filter(a => a.category === reviewCategory).map(article => (
                    <div key={article.id} className="border border-slate-200 dark:border-slate-700 rounded-lg p-4">
                      <div className="flex items-start justify-between gap-4">
                        <div className="flex-1">
                          <h4 className="font-medium text-slate-900 dark:text-slate-100 mb-2 line-clamp-2">{article.title}</h4>
                          <p className="text-sm text-slate-600 dark:text-slate-400 mb-2 line-clamp-2">{article.description}</p>
                          <div className="flex items-center gap-4 text-xs text-slate-500 dark:text-slate-500">
                            <span>Source: {article.source || article.publisher}</span>
                            <span>Date: {new Date(article.pubDate || article.fetchedAt).toLocaleDateString()}</span>
                            <span className="px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded">{article.category}</span>
                          </div>
                        </div>
                        <div className="flex flex-col gap-2">
                          <select
                            className="text-xs rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-2 py-1 text-slate-900 dark:text-white"
                            defaultValue=""
                            onChange={(e) => {
                              if (e.target.value && confirm(`Approve this article as ${e.target.value}?`)) {
                                approveArticle(article.id, e.target.value);
                              }
                            }}
                          >
                            <option value="" disabled>Approve as...</option>
                            <option value="relevant">RELEVANT ARTICLES</option>
                            <option value="transaction">TRANSACTIONS</option>
                            <option value="availabilities">AVAILABILITIES</option>
                            <option value="people">PEOPLE NEWS</option>
                          </select>
                          <button
                            onClick={() => blacklistArticle(article.id)}
                            className="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
                          >
                            Blacklist
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                  {filteredArticles.filter(a => a.category === reviewCategory).length === 0 && (
                    <p className="text-center text-slate-500 dark:text-slate-400 py-8">No articles found for this category.</p>
                  )}
                </div>
              </div>
            )}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* Manual Article Addition */}
            <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-sm p-6">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-xl font-semibold text-slate-900 dark:text-slate-100">üìù Add Manual Article</h2>
                <button
                  onClick={() => setShowManualForm(!showManualForm)}
                  className="px-3 py-1 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition-colors"
                >
                  {showManualForm ? 'Hide' : 'Show'} Form
                </button>
              </div>

              {showManualForm && (
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Title *</label>
                    <input
                      type="text"
                      value={manualTitle}
                      onChange={(e) => setManualTitle(e.target.value)}
                      className="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
                      placeholder="Article title"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">URL *</label>
                    <input
                      type="url"
                      value={manualUrl}
                      onChange={(e) => setManualUrl(e.target.value)}
                      className="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
                      placeholder="https://example.com/article"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Summary</label>
                    <textarea
                      value={manualSummary}
                      onChange={(e) => setManualSummary(e.target.value)}
                      rows={3}
                      className="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
                      placeholder="Brief summary of the article"
                    />
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Category</label>
                      <select
                        value={manualCategory}
                        onChange={(e) => setManualCategory(e.target.value)}
                        className="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
                      >
                        <option value="relevant">RELEVANT ARTICLES</option>
                        <option value="transaction">TRANSACTIONS</option>
                        <option value="availabilities">AVAILABILITIES</option>
                        <option value="people">PEOPLE NEWS</option>
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Source</label>
                      <input
                        type="text"
                        value={manualSource}
                        onChange={(e) => setManualSource(e.target.value)}
                        className="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
                        placeholder="Source name"
                      />
                    </div>
                  </div>

                  <button
                    onClick={onAddManualArticle}
                    className="w-full px-4 py-2 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600 transition-colors"
                  >
                    ‚ûï Add Article
                  </button>
                </div>
              )}
            </div>

            {/* Newsletter Recipients */}
            <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-sm p-6">
              <h2 className="text-xl font-semibold text-slate-900 dark:text-slate-100 mb-4">üìß Newsletter Recipients</h2>
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email Addresses</label>
                  <textarea
                    value={newsletterRecipients}
                    onChange={(e) => setNewsletterRecipients(e.target.value)}
                    rows={4}
                    className="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
                    placeholder="email1@company.com, email2@company.com&#10;Separate multiple emails with commas"
                  />
                </div>
                <div className="text-sm text-slate-600 dark:text-slate-400">
                  <p>‚Ä¢ Separate multiple recipients with commas</p>
                  <p>‚Ä¢ Recipients will be saved automatically</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };
    // ============================================
    // TRACKING COMPONENTS
    // ============================================

    // LocalStorage tracking utilities (inline for simplicity)
    const TRACKED_TOPICS_KEY = 'woodmont_tracked_topics';
    const TRACKED_ARTICLES_KEY = 'woodmont_tracked_articles';

    const getTrackedTopics = () => {
      try {
        const stored = localStorage.getItem(TRACKED_TOPICS_KEY);
        return stored ? JSON.parse(stored) : [];
      } catch (e) { return []; }
    };

    const addTrackedTopic = (keyword, articleTitle = '') => {
      const topics = getTrackedTopics();
      const normalizedKeyword = keyword.toLowerCase().trim();
      if (topics.some(t => t.keyword.toLowerCase() === normalizedKeyword)) return false;
      topics.push({ keyword: keyword.trim(), addedAt: new Date().toISOString(), articleTitle });
      try {
        localStorage.setItem(TRACKED_TOPICS_KEY, JSON.stringify(topics));
        return true;
      } catch (e) { return false; }
    };

    const removeTrackedTopic = (keyword) => {
      const topics = getTrackedTopics();
      const filtered = topics.filter(t => t.keyword.toLowerCase() !== keyword.toLowerCase().trim());
      try {
        localStorage.setItem(TRACKED_TOPICS_KEY, JSON.stringify(filtered));
        return true;
      } catch (e) { return false; }
    };

    const getMatchingTrackedTopics = (article) => {
      const topics = getTrackedTopics();
      const matches = [];
      const searchText = `${article.title || ''} ${article.description || ''} ${article.source || ''}`.toLowerCase();
      for (const topic of topics) {
        if (searchText.includes(topic.keyword.toLowerCase())) {
          matches.push(topic.keyword);
        }
      }
      return matches;
    };

    const extractTrackableKeywords = (article) => {
      const keywords = [];
      const title = article.title || '';
      // Extract company names
      const companyMatches = title.match(/[A-Z][a-z]+(?:\s+[A-Z][a-z]+)+/g) || [];
      keywords.push(...companyMatches.slice(0, 3));
      // Extract locations
      const locationMatches = title.match(/(New\s+Jersey|New\s+York|South\s+Florida|Pennsylvania|Miami-Dade|Broward|Philadelphia|Newark|Fort\s+Lauderdale|Miami)/gi) || [];
      keywords.push(...locationMatches.slice(0, 2));
      // Remove duplicates
      return [...new Set(keywords.map(k => k.trim()))].filter(k => k.length > 2 && k.length < 50);
    };

    // ============================================
    // IGNORE FUNCTIONS
    // ============================================
    const IGNORED_TOPICS_KEY = 'woodmont_ignored_topics';
    const IGNORED_ARTICLES_KEY = 'ignoredArticles';

    const getIgnoredTopics = () => {
      try {
        const stored = localStorage.getItem(IGNORED_TOPICS_KEY);
        return stored ? JSON.parse(stored) : [];
      } catch (e) { return []; }
    };

    // Get ignored articles from newsletter actions
    const getIgnoredArticles = () => {
      try {
        const stored = localStorage.getItem(IGNORED_ARTICLES_KEY);
        return stored ? JSON.parse(stored) : [];
      } catch (e) { return []; }
    };

    // Combined: get all ignored items (topics + articles)
    const getAllIgnored = () => {
      const topics = getIgnoredTopics().map(t => ({ ...t, type: 'topic' }));
      const articles = getIgnoredArticles().map(a => ({
        keyword: a.title || a.articleId?.substring(0, 50) || 'Unknown article',
        articleId: a.articleId,
        addedAt: a.ignoredAt,
        type: 'article'
      }));
      return [...topics, ...articles];
    };

    const addIgnoredTopic = (keyword) => {
      const topics = getIgnoredTopics();
      const normalizedKeyword = keyword.toLowerCase().trim();
      if (topics.some(t => t.keyword.toLowerCase() === normalizedKeyword)) return false;
      topics.push({ keyword: keyword.trim(), addedAt: new Date().toISOString() });
      try {
        localStorage.setItem(IGNORED_TOPICS_KEY, JSON.stringify(topics));
        return true;
      } catch (e) { return false; }
    };

    const removeIgnoredTopic = (keyword) => {
      const topics = getIgnoredTopics();
      const filtered = topics.filter(t => t.keyword.toLowerCase() !== keyword.toLowerCase().trim());
      try {
        localStorage.setItem(IGNORED_TOPICS_KEY, JSON.stringify(filtered));
        return true;
      } catch (e) { return false; }
    };

    // Remove ignored article by articleId or keyword
    const removeIgnoredArticle = (identifier) => {
      const articles = getIgnoredArticles();
      const filtered = articles.filter(a =>
        a.articleId !== identifier &&
        (a.title || '').toLowerCase() !== identifier.toLowerCase()
      );
      try {
        localStorage.setItem(IGNORED_ARTICLES_KEY, JSON.stringify(filtered));
        return true;
      } catch (e) { return false; }
    };

    // Remove any ignored item (topic or article)
    const removeIgnoredItem = (item) => {
      if (item.type === 'article') {
        return removeIgnoredArticle(item.articleId || item.keyword);
      } else {
        return removeIgnoredTopic(item.keyword);
      }
    };

    const isArticleIgnored = (article) => {
      // Check against ignored topics
      const topics = getIgnoredTopics();
      const searchText = `${article.title || ''} ${article.description || ''} ${article.source || ''}`.toLowerCase();
      if (topics.some(t => searchText.includes(t.keyword.toLowerCase()))) return true;

      // Check against ignored articles by URL
      const ignoredArticles = getIgnoredArticles();
      const articleUrl = article.url || article.link || '';
      return ignoredArticles.some(a => a.articleId === articleUrl);
    };

    // Tracked & Ignored Topics Panel Component
    const TrackedTopicsPanel = ({ trackedTopics, ignoredTopics, onRemoveTopic, onAddTopic, onRemoveIgnored, matchingCount }) => {
      const [newTopic, setNewTopic] = useState('');
      const [isExpanded, setIsExpanded] = useState(true);
      const [activeTab, setActiveTab] = useState('tracked'); // 'tracked' or 'ignored'

      const handleAddTopic = () => {
        if (newTopic.trim()) {
          onAddTopic(newTopic.trim());
          setNewTopic('');
        }
      };

      return (
        <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden mb-6">
          <div
            className="px-4 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 text-white cursor-pointer flex items-center justify-between"
            onClick={() => setIsExpanded(!isExpanded)}
          >
            <div className="flex items-center gap-2">
              <span className="text-lg font-semibold">Your Preferences</span>
              {matchingCount > 0 && (
                <span className="bg-white text-emerald-600 text-xs font-bold px-2 py-1 rounded-full">
                  {matchingCount} tracking
                </span>
              )}
              {ignoredTopics.length > 0 && (
                <span className="bg-red-100 text-red-600 text-xs font-bold px-2 py-1 rounded-full">
                  {ignoredTopics.length} ignored
                </span>
              )}
            </div>
            <span className="text-xl">{isExpanded ? '‚ñº' : '‚ñ∂'}</span>
          </div>

          {isExpanded && (
            <div className="p-4">
              {/* Tabs */}
              <div className="flex gap-2 mb-4">
                <button
                  onClick={() => setActiveTab('tracked')}
                  className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                    activeTab === 'tracked'
                      ? 'bg-emerald-500 text-white'
                      : 'bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300'
                  }`}
                >
                  Tracking ({trackedTopics.length})
                </button>
                <button
                  onClick={() => setActiveTab('ignored')}
                  className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                    activeTab === 'ignored'
                      ? 'bg-red-500 text-white'
                      : 'bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300'
                  }`}
                >
                  Ignored ({ignoredTopics.length})
                </button>
              </div>

              {activeTab === 'tracked' && (
                <>
                  {/* Add new topic input */}
                  <div className="flex gap-2 mb-3">
                    <input
                      type="text"
                      value={newTopic}
                      onChange={(e) => setNewTopic(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleAddTopic()}
                      placeholder="Add keyword to track..."
                      className="flex-1 px-3 py-2 text-sm border border-slate-200 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none"
                    />
                    <button
                      onClick={handleAddTopic}
                      className="px-4 py-2 bg-emerald-500 text-white rounded-lg text-sm font-medium hover:bg-emerald-600 transition-colors"
                    >
                      + Add
                    </button>
                  </div>

                  {trackedTopics.length === 0 ? (
                    <p className="text-slate-500 dark:text-slate-400 text-sm text-center py-4">
                      No topics tracked yet. Click "Track" on articles or add keywords above.
                    </p>
                  ) : (
                    <div className="flex flex-wrap gap-2">
                      {trackedTopics.map((topic, idx) => (
                        <div
                          key={idx}
                          className="flex items-center gap-2 bg-emerald-50 dark:bg-emerald-900/30 border border-emerald-200 dark:border-emerald-700 rounded-full px-3 py-1"
                        >
                          <span className="text-sm font-medium text-emerald-700 dark:text-emerald-300">{topic.keyword}</span>
                          <button
                            onClick={() => onRemoveTopic(topic.keyword)}
                            className="text-emerald-400 hover:text-red-500 transition-colors text-lg leading-none"
                            title="Stop tracking"
                          >
                            √ó
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                </>
              )}

              {activeTab === 'ignored' && (
                <>
                  {ignoredTopics.length === 0 ? (
                    <p className="text-slate-500 dark:text-slate-400 text-sm text-center py-4">
                      No items ignored. Click "Ignore" on articles to hide them.
                    </p>
                  ) : (
                    <div className="flex flex-wrap gap-2">
                      {ignoredTopics.map((item, idx) => (
                        <div
                          key={idx}
                          className={`flex items-center gap-2 rounded-full px-3 py-1 ${
                            item.type === 'article'
                              ? 'bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-700'
                              : 'bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700'
                          }`}
                        >
                          <span className="text-xs text-slate-400 dark:text-slate-500">
                            {item.type === 'article' ? 'üì∞' : 'üè∑Ô∏è'}
                          </span>
                          <span className={`text-sm font-medium ${
                            item.type === 'article'
                              ? 'text-orange-700 dark:text-orange-300'
                              : 'text-red-700 dark:text-red-300'
                          }`} title={item.articleId || item.keyword}>
                            {item.keyword.length > 40 ? item.keyword.substring(0, 40) + '...' : item.keyword}
                          </span>
                          <button
                            onClick={() => onRemoveIgnored(item)}
                            className="text-red-400 hover:text-slate-600 transition-colors text-lg leading-none"
                            title="Stop ignoring"
                          >
                            √ó
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                </>
              )}

              <p className="text-xs text-slate-400 mt-3">
                Preferences are stored in your browser. Tracked articles are highlighted, ignored articles are hidden.
              </p>
            </div>
          )}
        </div>
      );
    };

    const NewsletterPreview = ({ html, loading, timeframe, setTimeframe, theme, setTheme, onGenerate, onClear, generated, newsletterRecipients, setNewsletterRecipients, onSendEmail, emailLoading, feedHealthReport, showFeedHealth, setShowFeedHealth, onFetchFeedHealth, feedHealthLoading, onTrackKeyword, onIgnoreKeyword }) => {
      const [showTemplate, setShowTemplate] = useState(false);
      const [sendingEmail, setSendingEmail] = useState(false);

      // Listen for track/ignore messages from newsletter iframe
      useEffect(() => {
        const handleMessage = (event) => {
          if (event.data && event.data.type === 'track' && event.data.keyword) {
            onTrackKeyword && onTrackKeyword(event.data.keyword);
            alert(`Now tracking: "${event.data.keyword}"`);
            // Regenerate newsletter to reflect changes
            onGenerate && onGenerate();
          } else if (event.data && event.data.type === 'ignore' && event.data.keyword) {
            onIgnoreKeyword && onIgnoreKeyword(event.data.keyword);
            alert(`Now ignoring: "${event.data.keyword}". Newsletter will be regenerated.`);
            // Regenerate newsletter to exclude ignored articles
            onGenerate && onGenerate();
          }
        };
        window.addEventListener('message', handleMessage);
        return () => window.removeEventListener('message', handleMessage);
      }, [onTrackKeyword, onIgnoreKeyword, onGenerate]);
      
      const downloadNewsletter = useCallback(async () => {
        if (!html) return;
        
        try {
          // Create a temporary container
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = html;
          tempDiv.style.width = '210mm'; // A4 width
          tempDiv.style.padding = '20mm';
          tempDiv.style.backgroundColor = '#ffffff';
          tempDiv.style.position = 'absolute';
          tempDiv.style.left = '-9999px';
          tempDiv.style.top = '0';
          document.body.appendChild(tempDiv);
          
          // Wait for images to load
          const images = tempDiv.getElementsByTagName('img');
          await Promise.all(Array.from(images).map(img => {
            if (img.complete) return Promise.resolve();
            return new Promise((resolve, reject) => {
              img.onload = resolve;
              img.onerror = resolve; // Continue even if image fails
              setTimeout(resolve, 3000); // Timeout after 3 seconds
            });
          }));
          
          // Generate canvas
          const canvas = await html2canvas(tempDiv, {
            scale: 2,
            useCORS: true,
            allowTaint: false,
            backgroundColor: '#ffffff',
            width: tempDiv.scrollWidth,
            height: tempDiv.scrollHeight,
            windowWidth: tempDiv.scrollWidth,
            windowHeight: tempDiv.scrollHeight
          });

          // Remove temporary container
          document.body.removeChild(tempDiv);
          
          // Create PDF
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4'
          });

          const imgData = canvas.toDataURL('image/png');
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
          
          // Add image to PDF, handling multi-page if needed
          let heightLeft = pdfHeight;
          let position = 0;
          
          pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
          heightLeft -= pdf.internal.pageSize.getHeight();
          
          while (heightLeft >= 0) {
            position = heightLeft - pdfHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
            heightLeft -= pdf.internal.pageSize.getHeight();
          }
          
          // Save PDF
          const date = new Date().toISOString().split('T')[0];
          pdf.save(`industrial-newsletter-${date}.pdf`);
        } catch (error) {
          console.error('Error generating PDF:', error);
          alert('Error generating PDF. Please try again.');
        }
      }, [html]);

      if (loading) {
        return (
          <div className="max-w-6xl mx-auto px-4 pb-12">
            <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-sm p-8 animate-pulse">
              <div className="h-8 bg-slate-200 dark:bg-slate-700 rounded w-1/3 mb-6"></div>
              <div className="space-y-4">
                <div className="h-4 bg-slate-200 dark:bg-slate-700 rounded w-full"></div>
                <div className="h-4 bg-slate-200 dark:bg-slate-700 rounded w-5/6"></div>
                <div className="h-4 bg-slate-200 dark:bg-slate-700 rounded w-4/5"></div>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="max-w-6xl mx-auto px-4 pb-12">
          <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-sm p-6 mb-6">
            <div className="flex flex-wrap items-center gap-4 justify-between">
              <div className="flex items-center gap-4">
                <h2 className="text-xl font-semibold text-slate-900 dark:text-slate-100">üìß Newsletter Generator</h2>
                {generated && (
                  <span className="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded-full">
                    ‚úì Generated
                  </span>
                )}
              </div>
              
              <div className="flex items-center gap-3">
                <div className="flex items-center gap-2">
                  <label className="text-sm text-slate-600 dark:text-slate-400">Timeframe:</label>
                  <select
                    className="rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-1 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
                    value={timeframe}
                    onChange={(e) => setTimeframe(e.target.value)}
                  >
                    <option value="1">Last 24 hours</option>
                    <option value="2">Last 48 hours</option>
                    <option value="3">Last 3 days</option>
                    <option value="7">Last 7 days</option>
                    <option value="14">Last 14 days</option>
                    <option value="30">Last 30 days</option>
                    <option value="90">Last 90 days</option>
                  </select>
                </div>

                <div className="flex items-center gap-2">
                  <label className="text-sm text-slate-600 dark:text-slate-400">Theme:</label>
                  <select
                    className="rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-1 text-sm focus:ring-2 focus:ring-emerald-300 dark:focus:ring-emerald-600 outline-none text-slate-900 dark:text-white"
                    value={theme}
                    onChange={(e) => setTheme(e.target.value)}
                  >
                    <option value="default">Default (Colorful)</option>
                    <option value="goth">Goth (Executive)</option>
                  </select>
                </div>

                <button
                  onClick={onGenerate}
                  className="px-4 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors"
                >
                  Generate Newsletter
                </button>

                <button
                  onClick={onFetchFeedHealth}
                  disabled={feedHealthLoading}
                  className="px-4 py-2 bg-purple-500 text-white rounded-lg font-medium hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2"
                >
                  {feedHealthLoading ? (
                    <>
                      <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>
                      Loading...
                    </>
                  ) : (
                    <>üìä Feed Health</>
                  )}
                </button>
                
                {generated && (
                  <>
                    <button
                      onClick={downloadNewsletter}
                      className="px-4 py-2 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600 transition-colors"
                    >
                      üìÑ Download PDF
                    </button>
                    {!IS_STATIC && (
                    <button
                      onClick={onSendEmail}
                      disabled={emailLoading}
                      className="px-4 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2"
                    >
                      {emailLoading ? (
                        <>
                          <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>
                          Sending...
                        </>
                      ) : (
                        <>üìß Send Email</>
                      )}
                    </button>
                    )}
                <button
                      onClick={onClear}
                      className="px-4 py-2 bg-slate-500 text-white rounded-lg font-medium hover:bg-slate-600 transition-colors"
                    >
                      Clear
                </button>
                  </>
            )}
              </div>
            </div>
          </div>

          {html && (
            <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-sm overflow-hidden">
              <div className="p-6 border-b border-slate-200 dark:border-slate-700">
            <div className="flex items-center justify-between">
                  <h3 className="text-lg font-semibold text-slate-900 dark:text-slate-100">Preview</h3>
              <button
                onClick={() => setShowTemplate(!showTemplate)}
                    className="text-sm text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300"
              >
                    {showTemplate ? 'Hide Template' : 'Show Template'}
              </button>
            </div>
          </div>
              <div className="p-6">
                {showTemplate ? (
                  <div className="newsletter-content" dangerouslySetInnerHTML={{ __html: html }} />
                ) : (
                  <iframe
                    srcDoc={`<html><head><style>body{font-family:Arial,sans-serif;margin:20px;background:white;} .newsletter-content{max-width:800px;margin:0 auto;}</style></head><body><div class="newsletter-content">${html}</div></body></html>`}
                    className="w-full h-96 border border-slate-200 dark:border-slate-700 rounded-lg"
                    title="Newsletter Preview"
                  />
                )}
              </div>
            </div>
          )}

          {/* Feed Health Report */}
          {showFeedHealth && feedHealthReport && (
            <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-sm overflow-hidden mt-6">
              <div className="p-6 border-b border-slate-200 dark:border-slate-700">
                <div className="flex items-center justify-between">
                  <h3 className="text-lg font-semibold text-slate-900 dark:text-slate-100">üìä Feed Health Report</h3>
                  <button
                    onClick={() => setShowFeedHealth(false)}
                    className="text-sm text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"
                  >
                    ‚úï Close
                  </button>
                </div>
                <div className="mt-2 flex gap-4 text-sm">
                  <span className="text-slate-600 dark:text-slate-400">
                    Generated: {new Date(feedHealthReport.generatedAt).toLocaleString()}
                  </span>
                  <span className="text-green-600">
                    ‚úì {feedHealthReport.successfulFeeds} OK
                  </span>
                  <span className="text-red-600">
                    ‚úï {feedHealthReport.failedFeeds} Failed
                  </span>
                  <span className="text-slate-600 dark:text-slate-400">
                    {feedHealthReport.totalArticlesFetched} fetched ‚Üí {feedHealthReport.totalArticlesKept} kept
                  </span>
                </div>
              </div>
              <div className="p-6 max-h-96 overflow-y-auto">
                <table className="w-full text-sm">
                  <thead className="text-left border-b border-slate-200 dark:border-slate-700">
                    <tr>
                      <th className="pb-2 font-medium text-slate-700 dark:text-slate-300">Feed Name</th>
                      <th className="pb-2 font-medium text-slate-700 dark:text-slate-300">Status</th>
                      <th className="pb-2 font-medium text-slate-700 dark:text-slate-300 text-right">Fetched</th>
                      <th className="pb-2 font-medium text-slate-700 dark:text-slate-300 text-right">Kept</th>
                      <th className="pb-2 font-medium text-slate-700 dark:text-slate-300">Error</th>
                    </tr>
                  </thead>
                  <tbody>
                    {feedHealthReport.feeds.map((feed, idx) => (
                      <tr key={idx} className={`border-b border-slate-100 dark:border-slate-700 ${feed.status === 'failed' ? 'bg-red-50 dark:bg-red-900/20' : ''}`}>
                        <td className="py-2">
                          <div className="font-medium text-slate-900 dark:text-slate-100">{feed.name}</div>
                          <div className="text-xs text-slate-500 truncate max-w-xs" title={feed.url}>{feed.url}</div>
                        </td>
                        <td className="py-2">
                          {feed.status === 'ok' ? (
                            <span className="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded text-xs">OK</span>
                          ) : (
                            <span className="px-2 py-1 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded text-xs">FAILED</span>
                          )}
                        </td>
                        <td className="py-2 text-right text-slate-600 dark:text-slate-400">{feed.fetchedRaw}</td>
                        <td className="py-2 text-right text-slate-600 dark:text-slate-400">{feed.keptAfterFiltering}</td>
                        <td className="py-2 text-xs text-red-600 dark:text-red-400 max-w-xs truncate" title={feed.lastError || ''}>
                          {feed.lastError || '-'}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          )}
        </div>
      );
    };

    const App = () => {
      const [items, setItems] = useState([]);
      const [loading, setLoading] = useState(true);
      const [query, setQuery] = useState("");
      const [region, setRegion] = useState("");
      const [category, setCategory] = useState("");
      const [source, setSource] = useState("");
      const [sort, setSort] = useState("newest");
      const [timeframe, setTimeframe] = useState(""); // Show all articles by default
      const [lastUpdated, setLastUpdated] = useState("");
      const [viewMode, setViewMode] = useState("articles");
      const [theme, setTheme] = useState("light");
      const [newsletterHTML, setNewsletterHTML] = useState("");
      const [newsletterGenerated, setNewsletterGenerated] = useState(false);
      const [newsletterTimeframe, setNewsletterTimeframe] = useState("1");
      const [newsletterTheme, setNewsletterTheme] = useState("default");
      const [newsletterRecipients, setNewsletterRecipients] = useState("");
      const [refreshLoading, setRefreshLoading] = useState(false);
      const [lastFetchInfo, setLastFetchInfo] = useState(null);
      const [manualTitle, setManualTitle] = useState('');
      const [manualUrl, setManualUrl] = useState('');
      const [manualSummary, setManualSummary] = useState('');
      const [manualCategory, setManualCategory] = useState('relevant');
      const [manualSource, setManualSource] = useState('');
      const [showManualForm, setShowManualForm] = useState(false);
      const [emailLoading, setEmailLoading] = useState(false);
      const [selectedArticle, setSelectedArticle] = useState(null);
      const [showArticlePreview, setShowArticlePreview] = useState(false);
      const [reviewMode, setReviewMode] = useState(false);
      const [filteredArticles, setFilteredArticles] = useState([]);
      const [reviewCategory, setReviewCategory] = useState('not relevant');
      const [feedHealthReport, setFeedHealthReport] = useState(null);
      const [showFeedHealth, setShowFeedHealth] = useState(false);
      const [feedHealthLoading, setFeedHealthLoading] = useState(false);
      // Tracking state
      const [trackedTopics, setTrackedTopics] = useState(() => getTrackedTopics());

      // Tracking handlers
      const handleTrackKeyword = useCallback((keyword, articleTitle = '') => {
        if (addTrackedTopic(keyword, articleTitle)) {
          setTrackedTopics(getTrackedTopics());
          // Show brief confirmation (could use toast in future)
          console.log(`Now tracking: ${keyword}`);
        }
      }, []);

      const handleRemoveTrackedTopic = useCallback((keyword) => {
        if (removeTrackedTopic(keyword)) {
          setTrackedTopics(getTrackedTopics());
        }
      }, []);

      // Count matching articles for the badge
      const matchingArticlesCount = useMemo(() => {
        let count = 0;
        for (const item of items) {
          const matches = getMatchingTrackedTopics(item);
          if (matches.length > 0) count++;
        }
        return count;
      }, [items, trackedTopics]);

      // Ignore state - includes both topics and articles
      const [ignoredTopics, setIgnoredTopics] = useState(() => getAllIgnored());

      // Ignore handlers
      const handleIgnoreKeyword = useCallback((keyword) => {
        if (addIgnoredTopic(keyword)) {
          setIgnoredTopics(getAllIgnored());
          console.log(`Now ignoring: ${keyword}`);
        }
      }, []);

      const handleRemoveIgnoredTopic = useCallback((item) => {
        // Handle both old format (string keyword) and new format (object with type)
        if (typeof item === 'string') {
          if (removeIgnoredTopic(item)) {
            setIgnoredTopics(getAllIgnored());
          }
        } else if (removeIgnoredItem(item)) {
          setIgnoredTopics(getAllIgnored());
        }
      }, []);

      // Handle tracking from URL parameters (for newsletter links)
      useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const trackKeyword = urlParams.get('track');
        if (trackKeyword) {
          handleTrackKeyword(decodeURIComponent(trackKeyword));
          // Clean the URL
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      }, [handleTrackKeyword]);

      // Refresh ignored/tracked state when window gains focus or becomes visible
      useEffect(() => {
        const refreshFromStorage = () => {
          setIgnoredTopics(getAllIgnored());
          setTrackedTopics(getTrackedTopics());
        };

        // Refresh on focus
        window.addEventListener('focus', refreshFromStorage);

        // Refresh on visibility change (more reliable than focus)
        const handleVisibility = () => {
          if (document.visibilityState === 'visible') {
            refreshFromStorage();
          }
        };
        document.addEventListener('visibilitychange', handleVisibility);

        // Also refresh every 5 seconds to catch any missed updates
        const interval = setInterval(refreshFromStorage, 5000);

        return () => {
          window.removeEventListener('focus', refreshFromStorage);
          document.removeEventListener('visibilitychange', handleVisibility);
          clearInterval(interval);
        };
      }, []);

      // Handle action URL parameters - redirect to action.html if needed
      useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const action = urlParams.get('action');
        const articleId = urlParams.get('articleId');
        const keyword = urlParams.get('keyword');

        // If action params present, redirect to action.html
        if (action && (articleId || keyword)) {
          window.location.href = `action.html${window.location.search}`;
        }
      }, []);

      const fetchItems = useCallback(async (showLoading = true) => {
        if (showLoading) setLoading(true);
        try {
          // Use feed.json for static GitHub Pages, /api/articles for local server
          const url = IS_STATIC ? 'feed.json' : '/api/articles';
          const res = await fetch(url);
          if (!res.ok) {
            throw new Error(`Failed to fetch: ${res.status} ${res.statusText}`);
          }
          const data = await res.json();
          // Handle both JSON Feed format (items array) and API format
          const articles = IS_STATIC 
            ? (data.items || []).map(item => {
                // Handle author - can be object or string
                let authorName = '';
                if (item.author) {
                  authorName = typeof item.author === 'string' ? item.author : (item.author.name || '');
                }
                if (!authorName) {
                  authorName = item.source || 'Unknown';
                }
                
                // Determine category from tags
                const firstTag = item.tags?.[0] || '';
                const tagLower = firstTag.toLowerCase();
                let category = 'relevant';
                if (tagLower.includes('transaction')) category = 'transaction';
                else if (tagLower.includes('availab')) category = 'availabilities';
                else if (tagLower.includes('people')) category = 'people';
                
                return {
                  ...item,
                  link: item.url || item.link || '',
                  pubDate: item.date_published || item.pubDate || new Date().toISOString(),
                  description: item.content_text || item.content_html || item.description || '',
                  source: authorName,
                  category: category
                };
              })
            : (Array.isArray(data.items) ? data.items : []);
          setItems(articles);
          if (data.generatedAt) {
            const d = new Date(data.generatedAt);
            setLastUpdated(d.toLocaleString());
          } else {
            setLastUpdated(new Date().toLocaleString());
          }
        } catch (e) {
          console.error('Error fetching items:', e);
          setItems([]);
          setLastUpdated("");
          // Show error to user
          alert('Failed to load articles. Please refresh the page.');
        } finally {
          if (showLoading) setLoading(false);
        }
      }, []);

      const fetchLastFetchInfo = useCallback(async () => {
        if (IS_STATIC) return; // Skip for static mode
        try {
          const res = await fetch('/api/last-fetch');
          const data = await res.json();
          setLastFetchInfo(data);
        } catch (e) {
          console.error('Error fetching last fetch info:', e);
        }
      }, []);

      const onRefresh = useCallback(async () => {
        if (IS_STATIC) {
          // In static mode, just reload the page to get latest feed.json
          window.location.reload();
          return;
        }
        setRefreshLoading(true);
        try {
          console.log('Starting refresh...');
          const refreshResponse = await fetch('/api/refresh');
          console.log('Refresh API completed, fetching updated articles...');
          await fetchItems(true);
          await fetchLastFetchInfo();
          console.log('Refresh completed successfully');
        } catch (e) {
          console.error('Error refreshing:', e);
        } finally {
          setRefreshLoading(false);
        }
      }, [fetchItems, fetchLastFetchInfo]);

      // Client-side newsletter HTML generator for static mode
      const buildNewsletterHTML = (articles, days) => {
        const now = new Date();
        const startDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);
        const dateRange = `${startDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })} ‚Äì ${now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })} (ET)`;

        const relevant = articles.filter(a => a.category === 'relevant').slice(0, 10);
        const transactions = articles.filter(a => a.category === 'transaction').slice(0, 5);
        const availabilities = articles.filter(a => a.category === 'availabilities').slice(0, 5);
        const people = articles.filter(a => a.category === 'people').slice(0, 5);

        // Industrial relevance context based on category
        const relevanceContext = {
          transaction: 'This transaction signals market activity and pricing trends in the industrial sector.',
          availabilities: 'New availability in the market - potential opportunity for expansion or investment.',
          people: 'Personnel moves can indicate market shifts and new business opportunities.',
          relevant: 'Macro trend affecting industrial real estate fundamentals and investment decisions.'
        };

        const renderArticle = (item, category) => {
          const region = item.regions?.[0] || 'US';
          const title = item.title || 'Untitled';
          const desc = (item.description || '').substring(0, 200) + (item.description?.length > 200 ? '...' : '');
          const whyItMatters = relevanceContext[category] || relevanceContext.relevant;
          const source = item.source || 'Industry News';
          const articleId = item.id || item.link || title;

          return `<div class="article-card" data-article-id="${articleId}">
            <div class="article-title-header">
              <h3 class="article-title">${title}</h3>
            </div>
            <div class="article-header">
              <span class="badge badge-location">${region}</span>
              <span class="badge badge-category">${category.toUpperCase()}</span>
              <span class="badge badge-source">${source}</span>
            </div>
            <div class="article-description">
              <p>${desc}</p>
            </div>
            <div class="article-context">
              <strong>Why This Relates to Industrial News:</strong> ${whyItMatters}
            </div>
            <div class="article-source">
              <div class="source-info">
                <span class="source-label">Source:</span>
                <span class="source-name">${source}</span>
              </div>
              <div class="article-actions">
                <a href="${item.link}" class="action-btn source-btn" target="_blank">üì∞ Source</a>
                <button class="action-btn track-btn" onclick="window.parent.postMessage({type:'track',keyword:'${source.replace(/'/g, "\\'")}'},'*')">üìå Track</button>
                <button class="action-btn ignore-btn" onclick="window.parent.postMessage({type:'ignore',keyword:'${source.replace(/'/g, "\\'")}'},'*')">üö´ Ignore</button>
              </div>
            </div>
          </div>`;
        };
        
        const renderSection = (title, icon, items, category) => {
          const content = items.length > 0
            ? items.map(item => renderArticle(item, category)).join('')
            : '<div class="empty-section">No articles available for this section.</div>';
          return `<div class="section">
            <div class="section-header">
              <div class="section-icon">${icon}</div>
              <div class="section-title">${title}</div>
            </div>
            ${content}
          </div>`;
        };
        
        return `<!DOCTYPE html><html><head><style>
          *{margin:0;padding:0;box-sizing:border-box}
          body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);padding:20px}
          .container{max-width:800px;margin:0 auto;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.3)}
          .header{background:linear-gradient(135deg,#1e3c72,#2a5298);color:#fff;padding:40px 30px;text-align:center}
          .header h1{font-size:28px;margin-bottom:10px}.header .subtitle{font-size:16px;opacity:.9;margin-bottom:8px}
          .header .date-range{font-size:14px;opacity:.8;font-style:italic}
          .content{padding:30px}.section{margin-bottom:35px}
          .section-header{display:flex;align-items:center;margin-bottom:20px;padding-bottom:10px;border-bottom:3px solid #667eea}
          .section-icon{width:40px;height:40px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:8px;display:flex;align-items:center;justify-content:center;margin-right:15px;font-size:20px}
          .section-title{font-size:20px;color:#1e3c72;font-weight:600}
          .article-card{background:#f8f9fa;border-left:4px solid #667eea;padding:20px;margin-bottom:15px;border-radius:8px}
          .article-title-header{background:linear-gradient(135deg,#1e3c72,#2a5298);margin:-20px -20px 15px -20px;padding:15px 20px;border-radius:8px 8px 0 0}
          .article-title{font-size:16px;font-weight:600;color:#fff;margin:0;line-height:1.4}
          .article-header{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
          .badge{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;text-transform:uppercase}
          .badge-location{background:#e3f2fd;color:#1976d2}
          .badge-category{background:#f3e5f5;color:#7b1fa2}
          .badge-source{background:#e8f5e9;color:#388e3c}
          .article-description{color:#333;line-height:1.6;margin-bottom:12px;font-size:14px}
          .article-description p{margin:0}
          .article-context{background:#fff8e1;border-left:3px solid #ffa726;padding:10px 14px;margin-bottom:12px;border-radius:4px;font-size:13px;color:#555}
          .article-source{display:flex;align-items:center;justify-content:space-between;margin-top:12px;padding-top:12px;border-top:1px solid #dee2e6}
          .source-info{display:flex;align-items:center;gap:6px}
          .source-label{font-size:12px;color:#666}
          .source-name{font-size:13px;color:#1e3c72;font-weight:600}
          .read-more-btn{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:8px 16px;border-radius:6px;text-decoration:none;font-weight:500;font-size:13px}
          .article-actions{display:flex;gap:8px;align-items:center}
          .action-btn{padding:6px 12px;border-radius:6px;font-size:12px;font-weight:500;cursor:pointer;text-decoration:none;border:none;display:inline-flex;align-items:center;gap:4px}
          .source-btn{background:#e3f2fd;color:#1976d2;border:1px solid #bbdefb}
          .source-btn:hover{background:#bbdefb}
          .track-btn{background:#e8f5e9;color:#388e3c;border:1px solid #c8e6c9}
          .track-btn:hover{background:#c8e6c9}
          .ignore-btn{background:#ffebee;color:#d32f2f;border:1px solid #ffcdd2}
          .ignore-btn:hover{background:#ffcdd2}
          .empty-section{background:#f8f9fa;padding:20px;border-radius:8px;text-align:center;color:#666;font-style:italic}
          .footer{background:#f8f9fa;padding:25px 30px;text-align:center;color:#666;font-size:14px;border-top:1px solid #dee2e6}
        </style></head><body><div class="container">
          <div class="header">
            <h1>üè≠ Woodmont Industrial Partners</h1>
            <div class="subtitle">Daily Industrial News Briefing</div>
            <div class="date-range">Coverage Period: ${dateRange}</div>
            <div class="date-range">Focus Markets: NJ, PA, FL, TX</div>
          </div>
          <div class="content">
            ${renderSection('RELEVANT ARTICLES ‚Äî Macro Trends & Industrial Real Estate News', 'üì∞', relevant, 'relevant')}
            ${renderSection('TRANSACTIONS ‚Äî Notable Sales/Leases (‚â•100K SF or ‚â•$25M)', 'üíº', transactions, 'transaction')}
            ${renderSection('AVAILABILITIES ‚Äî New Industrial Properties for Sale/Lease', 'üè¢', availabilities, 'availabilities')}
            ${renderSection('PEOPLE NEWS ‚Äî Personnel Moves in Industrial Brokerage/Development', 'üë•', people, 'people')}
          </div>
          <div class="footer">
            <strong>Woodmont Industrial Partners</strong><br>
            Daily Industrial News Briefing ‚Äì Confidential & Proprietary<br>
            ¬© ${new Date().getFullYear()} All Rights Reserved
          </div>
        </div></body></html>`;
      };

      // Goth theme newsletter builder - executive style, dark header
      const buildGothNewsletterHTML = (articles, days) => {
        const now = new Date();
        const startDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);
        const dateRange = `${startDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })} ‚Äì ${now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })} (ET)`;

        const relevant = articles.filter(a => a.category === 'relevant').slice(0, 10);
        const transactions = articles.filter(a => a.category === 'transaction').slice(0, 5);
        const availabilities = articles.filter(a => a.category === 'availabilities').slice(0, 5);
        const people = articles.filter(a => a.category === 'people').slice(0, 5);

        const formatBullet = (item) => {
          const title = item.title || 'Untitled';
          const url = item.link || '#';
          const source = item.source || 'Industry News';
          const desc = (item.description || '').substring(0, 180) + (item.description?.length > 180 ? '...' : '');

          return `<li style="margin-bottom: 16px; padding-bottom: 14px; border-bottom: 1px solid #e8e8e8; list-style: none;">
            <a href="${url}" style="color: #1e3c72; text-decoration: none; font-weight: 600; font-size: 15px; line-height: 1.4; display: block;">${title}</a>
            ${desc ? `<p style="margin: 8px 0 0 0; color: #555; font-size: 13px; line-height: 1.5;">${desc}</p>` : ''}
            <div style="margin-top: 8px; display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
              <a href="${url}" style="background: #e3f2fd; color: #1976d2; padding: 4px 10px; border-radius: 4px; text-decoration: none; font-size: 11px; font-weight: 500;">üì∞ Source</a>
              <button onclick="window.parent.postMessage({type:'track',keyword:'${source.replace(/'/g, "\\'")}'},'*')" style="background: #e8f5e9; color: #388e3c; padding: 4px 10px; border-radius: 4px; border: none; font-size: 11px; font-weight: 500; cursor: pointer;">üìå Track</button>
              <button onclick="window.parent.postMessage({type:'ignore',keyword:'${source.replace(/'/g, "\\'")}'},'*')" style="background: #ffebee; color: #d32f2f; padding: 4px 10px; border-radius: 4px; border: none; font-size: 11px; font-weight: 500; cursor: pointer;">üö´ Ignore</button>
            </div>
          </li>`;
        };

        const renderSection = (title, items) => {
          if (!items || items.length === 0) {
            return `<div style="margin-bottom: 28px;">
              <h3 style="color: #1e3c72; font-size: 16px; font-weight: 700; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e8e8e8;">${title}</h3>
              <p style="color: #888; font-style: italic; margin-left: 20px;">No updates for this section.</p>
            </div>`;
          }
          return `<div style="margin-bottom: 28px;">
            <h3 style="color: #1e3c72; font-size: 16px; font-weight: 700; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e8e8e8;">${title}</h3>
            <ul style="margin: 0; padding-left: 0;">${items.map(formatBullet).join('')}</ul>
          </div>`;
        };

        return `<!DOCTYPE html><html><head><meta charset="UTF-8"></head><body style="margin: 0; padding: 20px; background: #f4f4f4; font-family: 'Segoe UI', Arial, sans-serif;">
          <div style="max-width: 700px; margin: 0 auto; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); color: #fff; padding: 30px; text-align: center;">
              <h1 style="margin: 0 0 8px 0; font-size: 24px; font-weight: 700;">üè≠ Woodmont Industrial Partners</h1>
              <p style="margin: 0 0 4px 0; font-size: 14px; opacity: 0.9;">Daily Industrial News Briefing ‚Äî Executive Summary</p>
              <p style="margin: 0; font-size: 12px; opacity: 0.7;">${dateRange} | Focus: NJ, PA, FL, TX</p>
            </div>
            <div style="padding: 24px;">
              ${renderSection('üì∞ MARKET INTELLIGENCE', relevant)}
              ${renderSection('üíº TRANSACTIONS (‚â•100K SF or ‚â•$25M)', transactions)}
              ${renderSection('üè¢ AVAILABILITIES', availabilities)}
              ${renderSection('üë• PEOPLE MOVES', people)}
            </div>
            <div style="background: #f8f8f8; padding: 20px; text-align: center; color: #666; font-size: 12px; border-top: 1px solid #e8e8e8;">
              <strong>Woodmont Industrial Partners</strong><br>
              Daily Industrial News Briefing ‚Äì Confidential & Proprietary<br>
              ¬© ${new Date().getFullYear()} All Rights Reserved
            </div>
          </div>
        </body></html>`;
      };

      const generateNewsletter = useCallback(async () => {
        setLoading(true);
        try {
          if (IS_STATIC) {
            // Generate newsletter client-side using loaded articles
            const days = parseInt(newsletterTimeframe, 10);
            const cutoff = new Date(Date.now() - days * 24 * 60 * 60 * 1000);
            // Filter by date AND exclude ignored articles
            const recentArticles = items.filter(item => {
              const pubDate = new Date(item.pubDate || item.fetchedAt || 0);
              return pubDate >= cutoff && !isArticleIgnored(item);
            });
            // Use selected theme
            const html = newsletterTheme === 'goth'
              ? buildGothNewsletterHTML(recentArticles, days)
              : buildNewsletterHTML(recentArticles, days);
            setNewsletterHTML(html);
            setNewsletterGenerated(true);
          } else {
            // For server-side, pass theme parameter
            const res = await fetch(`/api/newsletter?days=${newsletterTimeframe}&theme=${newsletterTheme}`);
            const data = await res.json();
            setNewsletterHTML(data.html || '');
            setNewsletterGenerated(true);
          }
        } catch (e) {
          console.error('Error generating newsletter:', e);
          setNewsletterHTML('<p>Error generating newsletter. Please try again.</p>');
        } finally {
          setLoading(false);
        }
      }, [newsletterTimeframe, newsletterTheme, items]);

      const clearNewsletter = useCallback(() => {
        setNewsletterHTML('');
        setNewsletterGenerated(false);
      }, []);

      const addManualArticle = useCallback(async () => {
        if (!manualTitle.trim() || !manualUrl.trim()) {
          alert('Title and URL are required');
          return;
        }

        try {
          const response = await fetch((API_BASE || '') + '/api/manual', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + (localStorage.getItem('api_key') || 'demo-key')
            },
            body: JSON.stringify({
              title: manualTitle,
              url: manualUrl,
              summary: manualSummary,
              category: manualCategory,
              source: manualSource || 'Manual Entry'
            })
          });

          if (response.ok) {
            alert('Article added successfully!');
            setManualTitle('');
            setManualUrl('');
            setManualSummary('');
            setManualCategory('relevant');
            setManualSource('');
            setShowManualForm(false);
            // Refresh articles
            fetchItems(true);
          } else {
            const error = await response.text();
            alert('Error adding article: ' + error);
          }
        } catch (error) {
          console.error('Error adding manual article:', error);
          alert('Error adding article. Check console for details.');
        }
      }, [manualTitle, manualUrl, manualSummary, manualCategory, manualSource, fetchItems]);

      const sendNewsletterEmail = useCallback(async () => {
        if (!newsletterHTML) {
          alert('Generate newsletter first');
          return;
        }

        setEmailLoading(true);
        try {
          const response = await fetch((API_BASE || '') + '/api/send-newsletter', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              html: newsletterHTML,
              timeframe: newsletterTimeframe,
              recipients: newsletterRecipients.split(',').map(r => r.trim()).filter(r => r)
            })
          });

          if (response.ok) {
            const result = await response.json();
            const recipientCount = result.recipients || 1;
            alert(`Newsletter sent successfully to ${recipientCount} recipient${recipientCount > 1 ? 's' : ''}!`);
          } else {
            const error = await response.text();
            alert('Error sending newsletter: ' + error);
          }
        } catch (error) {
          console.error('Error sending newsletter:', error);
          alert('Error sending newsletter. Check console for details.');
        } finally {
          setEmailLoading(false);
        }
      }, [newsletterHTML, newsletterTimeframe, newsletterRecipients]);

      const handleArticleClick = useCallback((article) => {
        setSelectedArticle(article);
        setShowArticlePreview(true);
      }, []);

      const closeArticlePreview = useCallback(() => {
        setSelectedArticle(null);
        setShowArticlePreview(false);
      }, []);

      const fetchFilteredArticles = useCallback(async () => {
        try {
          const res = await fetch((API_BASE || '') + '/api/articles');
          const data = await res.json();
          const allArticles = Array.isArray(data.items) ? data.items : [];
          const filtered = allArticles.filter(it => it.category === reviewCategory);
          setFilteredArticles(filtered);
        } catch (e) {
          console.error('Error fetching filtered articles:', e);
          setFilteredArticles([]);
        }
      }, [reviewCategory]);

      const approveArticle = useCallback(async (articleId, newCategory) => {
        try {
          const response = await fetch((API_BASE || '') + '/api/approve-article', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              articleId,
              newCategory
            })
          });

          if (response.ok) {
            alert('Article approved successfully!');
            fetchItems(true);
            fetchFilteredArticles();
          } else {
            const error = await response.text();
            alert('Error approving article: ' + error);
          }
        } catch (error) {
          console.error('Error approving article:', error);
          alert('Error approving article. Check console for details.');
        }
      }, [fetchItems, fetchFilteredArticles]);

      const blacklistArticle = useCallback(async (articleId) => {
        if (!confirm('Are you sure you want to blacklist this article?')) return;
        
        try {
          const response = await fetch((API_BASE || '') + '/api/blacklist-article', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              articleId
            })
          });

          if (response.ok) {
            alert('Article blacklisted successfully!');
            fetchItems(true);
            fetchFilteredArticles();
          } else {
            const error = await response.text();
            alert('Error blacklisting article: ' + error);
          }
        } catch (error) {
          console.error('Error blacklisting article:', error);
          alert('Error blacklisting article. Check console for details.');
        }
      }, [fetchItems, fetchFilteredArticles]);

      const fetchFeedHealth = useCallback(async () => {
        setFeedHealthLoading(true);
        try {
          const res = await fetch(IS_STATIC ? 'feed-health.json' : '/api/feed-health');
          if (!res.ok) {
            throw new Error(`Failed to fetch feed health: ${res.status}`);
          }
          const data = await res.json();
          setFeedHealthReport(data);
          setShowFeedHealth(true);
        } catch (e) {
          console.error('Error fetching feed health:', e);
          alert('Feed health report not available. It will be generated on the next scheduled RSS update.');
        } finally {
          setFeedHealthLoading(false);
        }
      }, []);

      useEffect(() => {
          fetchItems();
        fetchLastFetchInfo();
        
        const interval = setInterval(() => {
          if (viewMode === "articles") {
            fetchItems(false);
          }
        }, 5 * 60 * 1000); // 5 minutes

        return () => clearInterval(interval);
      }, [fetchItems, fetchLastFetchInfo, viewMode]);

      const sources = useMemo(() => {
        const uniqueSources = new Set(items.map(item => item.source || item.publisher).filter(Boolean));
        return Array.from(uniqueSources).sort();
      }, [items]);

      const filtered = useMemo(() => {
        let list = [...items];
        
        // Filter out articles with "not relevant", "excluded", and "blacklisted" categories
        list = list.filter(it => it.category !== 'not relevant' && it.category !== 'excluded' && it.category !== 'blacklisted');
        
        if (timeframe) {
          const daysAgo = parseInt(timeframe, 10);
          const cutoffDate = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);
          list = list.filter(it => {
            const pubDate = new Date(it.pubDate || it.fetchedAt || 0);
            return pubDate >= cutoffDate;
          });
        }
        
        if (query) {
          const q = query.toLowerCase();
          list = list.filter(it =>
            (it.title && it.title.toLowerCase().includes(q)) ||
            (it.description && it.description.toLowerCase().includes(q))
          );
        }

        if (region) {
          list = list.filter(it => {
            const r = region.toLowerCase();
            return (it.title + " " + it.description).toLowerCase().includes(r);
          });
        }

        if (category) {
          list = list.filter(it => it.category === category);
        }

        if (source) {
          list = list.filter(it => (it.source || it.publisher) === source);
        }

        if (sort === "newest") {
          list.sort((a, b) => new Date(b.pubDate || b.fetchedAt || 0) - new Date(a.pubDate || a.fetchedAt || 0));
        } else {
          list.sort((a, b) => new Date(a.pubDate || a.fetchedAt || 0) - new Date(b.pubDate || b.fetchedAt || 0));
        }

        return list;
      }, [items, query, region, category, source, sort, timeframe]);

      return (
        <div className={`min-h-screen ${theme === 'dark' ? 'dark bg-slate-900' : 'bg-slate-50'}`}>
          <div className="container">
          <Header timeframe={timeframe} theme={theme} setTheme={setTheme} />
          <FiltersBar
            query={query} setQuery={setQuery}
            region={region} setRegion={setRegion}
            category={category} setCategory={setCategory}
            source={source} setSource={setSource}
            sort={sort} setSort={setSort}
            timeframe={timeframe} setTimeframe={setTimeframe}
            sources={sources}
            onRefresh={onRefresh}
            stats={{ filtered: filtered.length, total: items.length, updated: lastUpdated }}
            viewMode={viewMode}
            setViewMode={setViewMode}
              lastFetchInfo={lastFetchInfo}
              refreshLoading={refreshLoading}
          />
          {viewMode === "articles" ? (
              <>
                {/* Tracked & Ignored Topics Panel */}
                <div className="max-w-6xl mx-auto px-4 mb-4">
                  <TrackedTopicsPanel
                    trackedTopics={trackedTopics}
                    ignoredTopics={ignoredTopics}
                    onRemoveTopic={handleRemoveTrackedTopic}
                    onAddTopic={handleTrackKeyword}
                    onRemoveIgnored={handleRemoveIgnoredTopic}
                    matchingCount={matchingArticlesCount}
                  />
                </div>
                <ArticleGrid
                  items={filtered}
                  loading={loading || refreshLoading}
                  onArticleClick={handleArticleClick}
                  trackedTopics={trackedTopics}
                  ignoredTopics={ignoredTopics}
                  onTrackKeyword={handleTrackKeyword}
                  onIgnoreKeyword={handleIgnoreKeyword}
                />
              </>
            ) : viewMode === "newsletter" ? (
            <NewsletterPreview
              html={newsletterHTML}
              loading={loading}
              timeframe={newsletterTimeframe}
              setTimeframe={setNewsletterTimeframe}
              theme={newsletterTheme}
              setTheme={setNewsletterTheme}
              onGenerate={generateNewsletter}
              onClear={clearNewsletter}
              generated={newsletterGenerated}
              newsletterRecipients={newsletterRecipients}
              setNewsletterRecipients={setNewsletterRecipients}
              onSendEmail={sendNewsletterEmail}
              emailLoading={emailLoading}
              feedHealthReport={feedHealthReport}
              showFeedHealth={showFeedHealth}
              setShowFeedHealth={setShowFeedHealth}
              onFetchFeedHealth={fetchFeedHealth}
              feedHealthLoading={feedHealthLoading}
              onTrackKeyword={handleTrackKeyword}
              onIgnoreKeyword={handleIgnoreKeyword}
              />
            ) : (
              <AdminPanel
                manualTitle={manualTitle}
                setManualTitle={setManualTitle}
                manualUrl={manualUrl}
                setManualUrl={setManualUrl}
                manualSummary={manualSummary}
                setManualSummary={setManualSummary}
                manualCategory={manualCategory}
                setManualCategory={setManualCategory}
                manualSource={manualSource}
                setManualSource={setManualSource}
                showManualForm={showManualForm}
                setShowManualForm={setShowManualForm}
                onAddManualArticle={addManualArticle}
                newsletterRecipients={newsletterRecipients}
                setNewsletterRecipients={setNewsletterRecipients}
                reviewMode={reviewMode}
                setReviewMode={setReviewMode}
                filteredArticles={filteredArticles}
                fetchFilteredArticles={fetchFilteredArticles}
                approveArticle={approveArticle}
                blacklistArticle={blacklistArticle}
                reviewCategory={reviewCategory}
                setReviewCategory={setReviewCategory}
              />
            )}

            {/* Article Preview Modal */}
            {showArticlePreview && (
              <ArticlePreview
                article={selectedArticle}
                onClose={closeArticlePreview}
                onBlacklist={blacklistArticle}
              />
            )}
          </div>

          {/* Footer with RSS/JSON Feed Links */}
          <footer className="mt-12 py-8 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900">
            <div className="max-w-6xl mx-auto px-4">
              <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div className="text-sm text-slate-500 dark:text-slate-400">
                  <span className="font-semibold text-slate-700 dark:text-slate-300">Woodmont Industrial Partners</span>
                  <span className="mx-2">‚Ä¢</span>
                  <span>Industrial News Briefing</span>
                </div>

                {/* Feed Subscription Buttons */}
                <div className="flex items-center gap-3">
                  <span className="text-xs text-slate-400 dark:text-slate-500 mr-2">Subscribe:</span>
                  <a
                    href="rss.xml"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="inline-flex items-center gap-2 px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white text-sm font-medium rounded-lg transition-colors shadow-sm"
                  >
                    <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1Z"/>
                    </svg>
                    RSS Feed
                  </a>
                  <a
                    href="feed.json"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="inline-flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white text-sm font-medium rounded-lg transition-colors shadow-sm"
                  >
                    <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M5 3h2v2H5v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5h2v2H5c-1.07-.27-2-.9-2-2v-4a2 2 0 0 0-2-2H0v-2h1a2 2 0 0 0 2-2V5a2 2 0 0 1 2-2m14 0a2 2 0 0 1 2 2v4a2 2 0 0 0 2 2h1v2h-1a2 2 0 0 0-2 2v4a2 2 0 0 1-2 2h-2v-2h2v-5a2 2 0 0 1 2-2 2 2 0 0 1-2-2V5h-2V3h2m-7 12a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m-4 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1m8 0a1 1 0 0 1 1 1 1 1 0 0 1-1 1 1 1 0 0 1-1-1 1 1 0 0 1 1-1Z"/>
                    </svg>
                    JSON Feed
                  </a>
                </div>
              </div>

              <div className="mt-4 text-center text-xs text-slate-400 dark:text-slate-500">
                ¬© {new Date().getFullYear()} Woodmont Industrial Partners. All Rights Reserved.
              </div>
            </div>
          </footer>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>