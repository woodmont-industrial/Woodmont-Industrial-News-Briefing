name: Update RSS Feed

on:
  schedule:
      - cron: '*/30 13-23 * * 1-5'
          - cron: '*/30 0-1 * * 2-6'
            workflow_dispatch:

            permissions:
              contents: write

              jobs:
                update-feed:
                    runs-on: ubuntu-latest
                        timeout-minutes: 15

                            steps:
                                  - name: Checkout repository
                                          uses: actions/checkout@v4
                                                  with:
                                                            fetch-depth: 0

                                                                  - name: Setup Node.js
                                                                          uses: actions/setup-node@v4
                                                                                  with:
                                                                                            node-version: '20'

                                                                                                  - name: Install dependencies
                                                                                                          run: npm install --prefer-offline --no-audit
                                                                                                          
                                                                                                                - name: Build RSS feeds
                                                                                                                        run: |
                                                                                                                                  echo "üì∞ Starting RSS feed build..."
                                                                                                                                            npm run build-static || echo "‚ö†Ô∏è Build had some errors but continuing..."
                                                                                                                                                      echo "‚úÖ Build step completed"
                                                                                                                                                              env:
                                                                                                                                                                        NODE_ENV: production
                                                                                                                                                                                timeout-minutes: 10
                                                                                                                                                                                
                                                                                                                                                                                      - name: Verify build output
                                                                                                                                                                                              run: |
                                                                                                                                                                                                        echo "üìÇ Checking docs/ folder..."
                                                                                                                                                                                                                  ls -la docs/
                                                                                                                                                                                                                            if [ -f "docs/rss.xml" ]; then
                                                                                                                                                                                                                                        echo "‚úÖ rss.xml exists"
                                                                                                                                                                                                                                                    head -20 docs/rss.xml
                                                                                                                                                                                                                                                              else
                                                                                                                                                                                                                                                                          echo "‚ö†Ô∏è rss.xml not found - build may have failed"
                                                                                                                                                                                                                                                                                    fi
                                                                                                                                                                                                                                                                                              if [ -f "docs/feed.json" ]; then
                                                                                                                                                                                                                                                                                                          echo "‚úÖ feed.json exists"
                                                                                                                                                                                                                                                                                                                    else
                                                                                                                                                                                                                                                                                                                                echo "‚ö†Ô∏è feed.json not found"
                                                                                                                                                                                                                                                                                                                                          fi
                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                - name: Setup Git config
                                                                                                                                                                                                                                                                                                                                                        run: |
                                                                                                                                                                                                                                                                                                                                                                  git config --local user.email "github-actions[bot]@users.noreply.github.com"
                                                                                                                                                                                                                                                                                                                                                                            git config --local user.name "github-actions[bot]"
                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                  - name: Commit and push if changed
                                                                                                                                                                                                                                                                                                                                                                                          run: |
                                                                                                                                                                                                                                                                                                                                                                                                    git add docs/
                                                                                                                                                                                                                                                                                                                                                                                                              if git diff --staged --quiet; then
                                                                                                                                                                                                                                                                                                                                                                                                                          echo "üìã No changes to commit"
                                                                                                                                                                                                                                                                                                                                                                                                                                    else
                                                                                                                                                                                                                                                                                                                                                                                                                                                git commit -m "üîÑ Auto-update RSS feed - $(date -u +'%Y-%m-%d %H:%M UTC')"
                                                                                                                                                                                                                                                                                                                                                                                                                                                            git push
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        echo "‚úÖ Changes pushed successfully"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  fi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: Report Success
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if: success()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  echo "::notice::‚úÖ RSS feed updated successfully!"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            echo "üìä RSS Feed: https://prcasley.github.io/Woodmont-Industrial-News-Briefing/rss.xml"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      echo "üåê Web UI: https://prcasley.github.io/Woodmont-Industrial-News-Briefing/"
